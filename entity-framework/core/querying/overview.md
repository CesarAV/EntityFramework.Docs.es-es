---
title: "Cómo funcionan - Core EF las consultas"
author: rowanmiller
ms.author: divega
ms.date: 10/27/2016
ms.assetid: de2e34cd-659b-4cab-b5ed-7a979c6bf120
ms.technology: entity-framework-core
uid: core/querying/overview
ms.openlocfilehash: 7fd2940d559f82016d7a8fc3fdcf3af0d5b8bc8f
ms.sourcegitcommit: 01a75cd483c1943ddd6f82af971f07abde20912e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/27/2017
---
# <a name="how-queries-work"></a><span data-ttu-id="cd957-102">Cómo funcionan las consultas</span><span class="sxs-lookup"><span data-stu-id="cd957-102">How Queries Work</span></span>

<span data-ttu-id="cd957-103">Entity Framework Core usa Language integrar Query (LINQ) para consultar los datos de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="cd957-103">Entity Framework Core uses Language Integrate Query (LINQ) to query data from the database.</span></span> <span data-ttu-id="cd957-104">LINQ permite usar C# (o el lenguaje .NET seleccionado) para escribir consultas fuertemente tipadas en función de sus contexto y la entidad que las clases derivadas.</span><span class="sxs-lookup"><span data-stu-id="cd957-104">LINQ allows you to use C# (or your .NET language of choice) to write strongly typed queries based on your derived context and entity classes.</span></span>

## <a name="the-life-of-a-query"></a><span data-ttu-id="cd957-105">La duración de una consulta</span><span class="sxs-lookup"><span data-stu-id="cd957-105">The life of a query</span></span>

<span data-ttu-id="cd957-106">La siguiente es una introducción de alto nivel del proceso de que cada consulta se lleva a cabo.</span><span class="sxs-lookup"><span data-stu-id="cd957-106">The following is a high level overview of the process each query goes through.</span></span>

1. <span data-ttu-id="cd957-107">Entity Framework Core para compilar una representación que está lista para ser procesados por el proveedor de base de datos procesa la consulta LINQ</span><span class="sxs-lookup"><span data-stu-id="cd957-107">The LINQ query is processed by Entity Framework Core to build a representation that is ready to be processed by the database provider</span></span>
   1. <span data-ttu-id="cd957-108">El resultado se almacena en caché para que no es necesario que este procesamiento se realiza cada vez que se ejecuta la consulta</span><span class="sxs-lookup"><span data-stu-id="cd957-108">The result is cached so that this processing does not need to be done every time the query is executed</span></span>
2. <span data-ttu-id="cd957-109">El resultado se pasa al proveedor de base de datos</span><span class="sxs-lookup"><span data-stu-id="cd957-109">The result is passed to the database provider</span></span>
   1. <span data-ttu-id="cd957-110">El proveedor de base de datos identifica qué partes de la consulta se pueden evaluar en la base de datos</span><span class="sxs-lookup"><span data-stu-id="cd957-110">The database provider identifies which parts of the query can be evaluated in the database</span></span>
   2. <span data-ttu-id="cd957-111">Estas partes de la consulta se traducen en lenguaje de consulta específica de la base de datos (p. ej. SQL para una base de datos relacional)</span><span class="sxs-lookup"><span data-stu-id="cd957-111">These parts of the query are translated to database specific query language (e.g. SQL for a relational database)</span></span>
   3. <span data-ttu-id="cd957-112">Una o más consultas se envían a la base de datos y el conjunto de resultados devuelto (resultados son valores de la base de datos, no las instancias de entidad)</span><span class="sxs-lookup"><span data-stu-id="cd957-112">One or more queries are sent to the database and the result set returned (results are values from the database, not entity instances)</span></span>
3. <span data-ttu-id="cd957-113">Para cada elemento del conjunto de resultados</span><span class="sxs-lookup"><span data-stu-id="cd957-113">For each item in the result set</span></span>
   1. <span data-ttu-id="cd957-114">Si se trata de una consulta de seguimiento, EF comprueba si los datos representan una entidad ya está en la herramienta de seguimiento de cambios para la instancia de contexto</span><span class="sxs-lookup"><span data-stu-id="cd957-114">If this is a tracking query, EF checks if the data represents an entity already in the change tracker for the context instance</span></span>
      * <span data-ttu-id="cd957-115">Si es así, se devuelve la entidad existente</span><span class="sxs-lookup"><span data-stu-id="cd957-115">If so, the existing entity is returned</span></span>
      * <span data-ttu-id="cd957-116">De lo contrario, se crea una nueva entidad, seguimiento de cambios está configurado y se devuelve la nueva entidad</span><span class="sxs-lookup"><span data-stu-id="cd957-116">If not, a new entity is created, change tracking is setup, and the new entity is returned</span></span>
   2. <span data-ttu-id="cd957-117">Si se trata de una consulta de seguimiento no, EF comprueba si los datos representan una entidad ya está en el conjunto de resultados de esta consulta</span><span class="sxs-lookup"><span data-stu-id="cd957-117">If this is a no-tracking query, EF checks if the data represents an entity already in the result set for this query</span></span>
      * <span data-ttu-id="cd957-118">Si es así, se devuelve la entidad existente <sup>(1)</sup></span><span class="sxs-lookup"><span data-stu-id="cd957-118">If so, the existing entity is returned <sup>(1)</sup></span></span>
      * <span data-ttu-id="cd957-119">En caso contrario, se crea y devuelve una nueva entidad</span><span class="sxs-lookup"><span data-stu-id="cd957-119">If not, a new entity is created and returned</span></span>

<span data-ttu-id="cd957-120"><sup>(1) </sup> Ninguna consulta de seguimiento utiliza referencias débiles para realizar un seguimiento de las entidades que ya se han devuelto.</span><span class="sxs-lookup"><span data-stu-id="cd957-120"><sup>(1)</sup> No tracking queries use weak references to keep track of entities that have already been returned.</span></span> <span data-ttu-id="cd957-121">Si un resultado anterior con la misma identidad queda fuera del ámbito y se ejecuta la recolección de elementos no utilizados, obtendrá una nueva instancia de entidad.</span><span class="sxs-lookup"><span data-stu-id="cd957-121">If a previous result with the same identity goes out of scope, and garbage collection runs, you may get a new entity instance.</span></span>

## <a name="when-queries-are-executed"></a><span data-ttu-id="cd957-122">Cuando se ejecutan consultas</span><span class="sxs-lookup"><span data-stu-id="cd957-122">When queries are executed</span></span>

<span data-ttu-id="cd957-123">Cuando se llama a los operadores de LINQ, simplemente se está creando una representación en memoria de la consulta.</span><span class="sxs-lookup"><span data-stu-id="cd957-123">When you call LINQ operators, you are simply building up an in-memory representation of the query.</span></span> <span data-ttu-id="cd957-124">La consulta solo se envía a la base de datos cuando se utilizan los resultados.</span><span class="sxs-lookup"><span data-stu-id="cd957-124">The query is only sent to the database when the results are consumed.</span></span>

<span data-ttu-id="cd957-125">Las operaciones más comunes que son el resultado de la consulta que se envían a la base de datos son:</span><span class="sxs-lookup"><span data-stu-id="cd957-125">The most common operations that result in the query being sent to the database are:</span></span>
* <span data-ttu-id="cd957-126">Recorrer en iteración los resultados en un `for` bucles</span><span class="sxs-lookup"><span data-stu-id="cd957-126">Iterating the results in a `for` loop</span></span>
* <span data-ttu-id="cd957-127">Uso de un operador como `ToList`, `ToArray`, `Single`,`Count`</span><span class="sxs-lookup"><span data-stu-id="cd957-127">Using an operator such as `ToList`, `ToArray`, `Single`, `Count`</span></span>
* <span data-ttu-id="cd957-128">Enlace de datos de los resultados de una consulta a una interfaz de usuario</span><span class="sxs-lookup"><span data-stu-id="cd957-128">Databinding the results of a query to a UI</span></span>

> [!WARNING]  
> <span data-ttu-id="cd957-129">**Valide siempre los datos proporcionados por el usuario:** EF mientras protegen contra ataques de inyección de SQL, no lleva a cabo ninguna validación de entrada general.</span><span class="sxs-lookup"><span data-stu-id="cd957-129">**Always validate user input:** While EF does provide protection from SQL injection attacks, it does not do any general validation of input.</span></span> <span data-ttu-id="cd957-130">Por lo tanto, si los valores que se pasan a la API, que se usan en las consultas LINQ, asignadas a las propiedades de la entidad, etc., proceden de un origen de confianza, a continuación, validación adecuada, según sus requisitos de aplicación, debe realizarse.</span><span class="sxs-lookup"><span data-stu-id="cd957-130">Therefore if values being passed to APIs, used in LINQ queries, assigned to entity properties, etc., come from an untrusted source then appropriate validation, per your application requirements, should be performed.</span></span> <span data-ttu-id="cd957-131">Esto incluye cualquier proporcionados por el usuario utilizado para construir dinámicamente las consultas.</span><span class="sxs-lookup"><span data-stu-id="cd957-131">This includes any user input used to dynamically construct queries.</span></span> <span data-ttu-id="cd957-132">Incluso cuando se usa LINQ, si se acepta la entrada del usuario generar expresiones que debe asegurarse de que solo las expresiones previstas puede crearse.</span><span class="sxs-lookup"><span data-stu-id="cd957-132">Even when using LINQ, if you are accepting user input to build expressions you need to make sure than only intended expressions can be constructed.</span></span>
