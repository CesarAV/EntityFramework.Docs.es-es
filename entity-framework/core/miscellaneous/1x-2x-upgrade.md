---
title: Actualización desde versiones anteriores a EF Core 2 - EF Core
author: divega
ms.date: 8/13/2017
ms.assetid: 8BD43C8C-63D9-4F3A-B954-7BC518A1B7DB
uid: core/miscellaneous/1x-2x-upgrade
ms.openlocfilehash: 18c7fc841affc2776d054e447aa231a5f4bcd585
ms.sourcegitcommit: 0d36e8ff0892b7f034b765b15e041f375f88579a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/09/2018
ms.locfileid: "44251185"
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="289c7-102">Actualización de aplicaciones desde versiones anteriores a EF Core 2.0</span><span class="sxs-lookup"><span data-stu-id="289c7-102">Upgrading applications from previous versions to EF Core 2.0</span></span>

<span data-ttu-id="289c7-103">Hemos tomado la oportunidad para redefinir significativamente nuestras API existentes y los comportamientos en 2.0.</span><span class="sxs-lookup"><span data-stu-id="289c7-103">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="289c7-104">Hay algunas mejoras que pueden requerir la modificación de código de aplicación existente, aunque creemos para la mayoría de las aplicaciones el impacto suele ser bajo, en la mayoría de los casos que requieren solo recompilación y unos cambios mínimos guiados para reemplazar API obsoletas.</span><span class="sxs-lookup"><span data-stu-id="289c7-104">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

## <a name="procedures-common-to-all-applications"></a><span data-ttu-id="289c7-105">Los procedimientos comunes a todas las aplicaciones</span><span class="sxs-lookup"><span data-stu-id="289c7-105">Procedures Common to All Applications</span></span>

<span data-ttu-id="289c7-106">Puede requerir la actualización de una aplicación existente a EF Core 2.0:</span><span class="sxs-lookup"><span data-stu-id="289c7-106">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="289c7-107">Actualización de la plataforma .NET de destino de la aplicación a una que admita .NET Standard 2.0.</span><span class="sxs-lookup"><span data-stu-id="289c7-107">Upgrading the target .NET platform of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="289c7-108">Consulte [plataformas admitidas](../platforms/index.md) para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="289c7-108">See [Supported Platforms](../platforms/index.md) for more details.</span></span>

2. <span data-ttu-id="289c7-109">Identificar un proveedor para la base de datos de destino que es compatible con EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="289c7-109">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="289c7-110">Consulte [EF Core 2.0 requiere un proveedor de base de 2.0 datos](#ef-core-20-requires-a-20-database-provider) a continuación.</span><span class="sxs-lookup"><span data-stu-id="289c7-110">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="289c7-111">Actualizar todos los paquetes de EF Core (tooling y en tiempo de ejecución) a la 2.0.</span><span class="sxs-lookup"><span data-stu-id="289c7-111">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="289c7-112">Consulte [instalar EF Core](../get-started/install/index.md) para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="289c7-112">Refer to [Installing EF Core](../get-started/install/index.md) for more details.</span></span>

4. <span data-ttu-id="289c7-113">Realice los cambios de código necesario para compensar cambios importantes.</span><span class="sxs-lookup"><span data-stu-id="289c7-113">Make any necessary code changes to compensate for breaking changes.</span></span> <span data-ttu-id="289c7-114">Consulte la [Breaking Changes](#breaking-changes) sección para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="289c7-114">See the [Breaking Changes](#breaking-changes) section below for more details.</span></span>

## <a name="aspnet-core-applications"></a><span data-ttu-id="289c7-115">Aplicaciones ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="289c7-115">ASP.NET Core applications</span></span>

1. <span data-ttu-id="289c7-116">Vea en particular el [nuevo patrón para inicializar el proveedor de servicios de la aplicación](#new-way-of-getting-application-services) se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="289c7-116">See in particular the [new pattern for initializing the application's service provider](#new-way-of-getting-application-services) described below.</span></span>

> [!TIP]  
> <span data-ttu-id="289c7-117">La adopción de este nuevo patrón al actualizar las aplicaciones a 2.0 es muy recomendable y es necesario para características de producto como migraciones de Entity Framework Core funcione.</span><span class="sxs-lookup"><span data-stu-id="289c7-117">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="289c7-118">La otra alternativa común es [implementar *IDesignTimeDbContextFactory\<TContext >*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span><span class="sxs-lookup"><span data-stu-id="289c7-118">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span></span>

2. <span data-ttu-id="289c7-119">Las aplicaciones para ASP.NET Core 2.0 pueden usar EF Core 2.0 sin dependencias adicionales además de proveedores de bases de datos de terceros.</span><span class="sxs-lookup"><span data-stu-id="289c7-119">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="289c7-120">Sin embargo, las aplicaciones destinadas a versiones anteriores de ASP.NET Core deben actualizar a ASP.NET Core 2.0 para poder usar EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="289c7-120">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="289c7-121">Para obtener más información sobre cómo actualizar las aplicaciones ASP.NET Core 2.0, consulte [la documentación de ASP.NET Core en el asunto](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="289c7-121">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="new-way-of-getting-application-services"></a><span data-ttu-id="289c7-122">Nueva forma de obtener los servicios de aplicación</span><span class="sxs-lookup"><span data-stu-id="289c7-122">New way of getting application services</span></span>

<span data-ttu-id="289c7-123">Se actualizó el patrón recomendado para aplicaciones web ASP.NET Core 2.0 de forma que se interrumpió la lógica en tiempo de diseño que usa EF Core en la versión 1.x.</span><span class="sxs-lookup"><span data-stu-id="289c7-123">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="289c7-124">Anteriormente en tiempo de diseño, EF Core intentaría invocar `Startup.ConfigureServices` directamente con el fin de obtener acceso a proveedor de servicios de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="289c7-124">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="289c7-125">En ASP.NET Core 2.0, se inicializa la configuración fuera de la `Startup` clase.</span><span class="sxs-lookup"><span data-stu-id="289c7-125">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="289c7-126">Las aplicaciones que usan EF Core suelen tener acceso a su cadena de conexión de configuración, por lo que `Startup` por sí mismo ya no es suficiente.</span><span class="sxs-lookup"><span data-stu-id="289c7-126">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="289c7-127">Si actualiza una aplicación de ASP.NET Core 1.x, puede recibir el siguiente error al usar las herramientas de EF Core.</span><span class="sxs-lookup"><span data-stu-id="289c7-127">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="289c7-128">No se encontró ningún constructor sin parámetros en 'ApplicationContext'.</span><span class="sxs-lookup"><span data-stu-id="289c7-128">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="289c7-129">Agregue un constructor sin parámetros para 'ApplicationContext' o agregue una implementación de ' IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' en el mismo ensamblado que 'ApplicationContext'</span><span class="sxs-lookup"><span data-stu-id="289c7-129">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="289c7-130">Se ha agregado un nuevo enlace de tiempo de diseño en la plantilla predeterminada de ASP.NET Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="289c7-130">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="289c7-131">Estático `Program.BuildWebHost` método permite que EF Core tener acceso a proveedor de servicios de la aplicación en tiempo de diseño.</span><span class="sxs-lookup"><span data-stu-id="289c7-131">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="289c7-132">Si va a actualizar una aplicación de ASP.NET Core 1.x, deberá actualizar le `Program` clase similar a lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="289c7-132">If you are upgrading an ASP.NET Core 1.x application, you will need to update you `Program` class to resemble the following.</span></span>

``` csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

## <a name="idbcontextfactory-renamed"></a><span data-ttu-id="289c7-133">Cambiar el nombre de IDbContextFactory</span><span class="sxs-lookup"><span data-stu-id="289c7-133">IDbContextFactory renamed</span></span>

<span data-ttu-id="289c7-134">Con el fin de admitir patrones de aplicación diferentes y proporcionar a los usuarios más control sobre cómo sus `DbContext` se utiliza en tiempo de diseño, entregamos, en el pasado, el `IDbContextFactory<TContext>` interfaz.</span><span class="sxs-lookup"><span data-stu-id="289c7-134">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="289c7-135">En tiempo de diseño, las herramientas de EF Core detectará las implementaciones de esta interfaz en el proyecto y usarlo para crear `DbContext` objetos.</span><span class="sxs-lookup"><span data-stu-id="289c7-135">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="289c7-136">Esta interfaz tenía un nombre muy general que confundir a algunos usuarios para intentar volver a usarla para otros `DbContext`-creación de escenarios.</span><span class="sxs-lookup"><span data-stu-id="289c7-136">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="289c7-137">Que se ven desprevenidas cuando las herramientas de EF, a continuación, ha intentado usar su implementación en tiempo de diseño y provocó comandos como `Update-Database` o `dotnet ef database update` para producir un error.</span><span class="sxs-lookup"><span data-stu-id="289c7-137">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="289c7-138">Con el fin de comunicar la semántica de tiempo de diseño segura de esta interfaz, nos hemos cambiado el nombre a `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="289c7-138">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="289c7-139">Para la versión 2.0 de la versión de la `IDbContextFactory<TContext>` todavía existe, pero está marcado como obsoleto.</span><span class="sxs-lookup"><span data-stu-id="289c7-139">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

## <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="289c7-140">Quitar DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="289c7-140">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="289c7-141">Debido a los cambios de ASP.NET Core 2.0 se ha descrito anteriormente, hemos encontrado que `DbContextFactoryOptions` ya no era necesario en el nuevo `IDesignTimeDbContextFactory<TContext>` interfaz.</span><span class="sxs-lookup"><span data-stu-id="289c7-141">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="289c7-142">Estas son las alternativas que se debería utilizar en su lugar.</span><span class="sxs-lookup"><span data-stu-id="289c7-142">Here are the alternatives you should be using instead.</span></span>

| <span data-ttu-id="289c7-143">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="289c7-143">DbContextFactoryOptions</span></span> | <span data-ttu-id="289c7-144">Alternativa</span><span class="sxs-lookup"><span data-stu-id="289c7-144">Alternative</span></span>                                                  |
|:------------------------|:-------------------------------------------------------------|
| <span data-ttu-id="289c7-145">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="289c7-145">ApplicationBasePath</span></span>     | <span data-ttu-id="289c7-146">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="289c7-146">AppContext.BaseDirectory</span></span>                                     |
| <span data-ttu-id="289c7-147">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="289c7-147">ContentRootPath</span></span>         | <span data-ttu-id="289c7-148">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="289c7-148">Directory.GetCurrentDirectory()</span></span>                              |
| <span data-ttu-id="289c7-149">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="289c7-149">EnvironmentName</span></span>         | <span data-ttu-id="289c7-150">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="289c7-150">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span> |

## <a name="design-time-working-directory-changed"></a><span data-ttu-id="289c7-151">Puede cambiar el directorio de trabajo de tiempo de diseño</span><span class="sxs-lookup"><span data-stu-id="289c7-151">Design-time working directory changed</span></span>

<span data-ttu-id="289c7-152">Los cambios de ASP.NET Core 2.0 requieren también el directorio de trabajo usando `dotnet ef` para alinearse con el directorio de trabajo que usa Visual Studio cuando se ejecuta la aplicación.</span><span class="sxs-lookup"><span data-stu-id="289c7-152">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="289c7-153">Un efecto secundario observable de esto es que SQLite los nombres de archivo están ahora en relación con el directorio del proyecto y no en el directorio de salida como los que.</span><span class="sxs-lookup"><span data-stu-id="289c7-153">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

## <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="289c7-154">EF Core 2.0 requiere un proveedor de base de 2.0 datos</span><span class="sxs-lookup"><span data-stu-id="289c7-154">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="289c7-155">Para EF Core 2.0 se han realizado muchas mejoras en los proveedores de base de datos de manera y simplificaciones funcione.</span><span class="sxs-lookup"><span data-stu-id="289c7-155">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="289c7-156">Esto significa que los proveedores de 1.0 y 1.1 no funcionarán con EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="289c7-156">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="289c7-157">Los proveedores de SQL Server y SQLite enviados por el equipo de EF y 2.0 versiones estará disponibles como parte de la versión 2.0 de versión.</span><span class="sxs-lookup"><span data-stu-id="289c7-157">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="289c7-158">Los proveedores de código abierto de terceros para [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), y [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) se actualizan para 2.0.</span><span class="sxs-lookup"><span data-stu-id="289c7-158">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="289c7-159">Para todos los otros proveedores, póngase en contacto con el escritor de proveedores.</span><span class="sxs-lookup"><span data-stu-id="289c7-159">For all other providers, please contact the provider writer.</span></span>

## <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="289c7-160">Han cambiado los eventos de registro y diagnóstico</span><span class="sxs-lookup"><span data-stu-id="289c7-160">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="289c7-161">Nota: estos cambios no deberían afectar a la mayoría de código de aplicación.</span><span class="sxs-lookup"><span data-stu-id="289c7-161">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="289c7-162">Los identificadores de evento para los mensajes enviados a un [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) han cambiado en 2.0.</span><span class="sxs-lookup"><span data-stu-id="289c7-162">The event IDs for messages sent to an [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) have changed in 2.0.</span></span> <span data-ttu-id="289c7-163">Los identificadores de evento ahora son únicos en el código de EF Core.</span><span class="sxs-lookup"><span data-stu-id="289c7-163">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="289c7-164">Ahora, estos mensajes también siguen el patrón estándar de registro estructurado que usa, por ejemplo, MVC.</span><span class="sxs-lookup"><span data-stu-id="289c7-164">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="289c7-165">Las categorías de registrador también han cambiado.</span><span class="sxs-lookup"><span data-stu-id="289c7-165">Logger categories have also changed.</span></span> <span data-ttu-id="289c7-166">Ahora hay un conjunto conocido de categorías a las que se accede a través de [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span><span class="sxs-lookup"><span data-stu-id="289c7-166">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="289c7-167">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) eventos ahora usan los mismos nombres de Id. de evento correspondiente `ILogger` mensajes.</span><span class="sxs-lookup"><span data-stu-id="289c7-167">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="289c7-168">Las cargas del evento son todos los tipos nominales que se deriva de [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span><span class="sxs-lookup"><span data-stu-id="289c7-168">The event payloads are all nominal types derived from [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span></span>

<span data-ttu-id="289c7-169">Id. de evento, tipos de carga y categorías se documentan en el [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) y [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) clases.</span><span class="sxs-lookup"><span data-stu-id="289c7-169">Event IDs, payload types, and categories are documented in the [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) and the [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) classes.</span></span>

<span data-ttu-id="289c7-170">Identificadores también han movido desde Microsoft.EntityFrameworkCore.Infraestructure a nuevo espacio de nombres Microsoft.EntityFrameworkCore.Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="289c7-170">IDs have also moved from Microsoft.EntityFrameworkCore.Infraestructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

## <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="289c7-171">API de metadatos relacionales cambios EF Core</span><span class="sxs-lookup"><span data-stu-id="289c7-171">EF Core relational metadata API changes</span></span>

<span data-ttu-id="289c7-172">EF Core 2.0 ahora compila un elemento [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) diferente para cada proveedor que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="289c7-172">EF Core 2.0 will now build a different [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) for each different provider being used.</span></span> <span data-ttu-id="289c7-173">Esto suele ser transparente para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="289c7-173">This is usually transparent to the application.</span></span> <span data-ttu-id="289c7-174">Esto ha permitido una simplificación de las API de metadatos de nivel inferior, de modo que cualquier acceso a _conceptos de metadatos relacionales comunes_ siempre se realiza mediante una llamada a `.Relational` en lugar de a `.SqlServer`, `.Sqlite`, etc. Por ejemplo, 1.1 código similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="289c7-174">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="289c7-175">Ahora debe escribirse como esta:</span><span class="sxs-lookup"><span data-stu-id="289c7-175">Should now be written like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="289c7-176">En lugar de usar métodos como `ForSqlServerToTable`, métodos de extensión ahora están disponibles para escribir código condicional basado en el proveedor actual en uso.</span><span class="sxs-lookup"><span data-stu-id="289c7-176">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="289c7-177">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="289c7-177">For example:</span></span>

```C#
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="289c7-178">Tenga en cuenta que este cambio solo se aplica a las API y metadatos que se define para _todas_ proveedores relacionales.</span><span class="sxs-lookup"><span data-stu-id="289c7-178">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="289c7-179">La API y los metadatos permanece invariable cuando es solo un único proveedor específico.</span><span class="sxs-lookup"><span data-stu-id="289c7-179">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="289c7-180">Por ejemplo, los índices agrupados son específicos de SQL Server, por lo que `ForSqlServerIsClustered` y `.SqlServer().IsClustered()` debe seguir usándose.</span><span class="sxs-lookup"><span data-stu-id="289c7-180">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

## <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="289c7-181">No tome el control del proveedor de servicios EF</span><span class="sxs-lookup"><span data-stu-id="289c7-181">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="289c7-182">EF Core usa una instancia interna `IServiceProvider` (un contenedor de inserción de dependencia) para su implementación interna.</span><span class="sxs-lookup"><span data-stu-id="289c7-182">EF Core uses an internal `IServiceProvider` (a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="289c7-183">Las aplicaciones deben permitir que EF Core crear y administrar este proveedor, excepto en casos especiales.</span><span class="sxs-lookup"><span data-stu-id="289c7-183">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="289c7-184">Considerar la eliminación de todas las llamadas a `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="289c7-184">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="289c7-185">Si una aplicación necesita llamar a `UseInternalServiceProvider`, a continuación, considere la posibilidad de [archivando un problema](https://github.com/aspnet/EntityFramework/Issues) para que podamos investigarlo otras formas de controlar su escenario.</span><span class="sxs-lookup"><span data-stu-id="289c7-185">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/aspnet/EntityFramework/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="289c7-186">Una llamada a `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. no es necesario el código de aplicación a menos que `UseInternalServiceProvider` también se denomina.</span><span class="sxs-lookup"><span data-stu-id="289c7-186">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="289c7-187">Quite cualquier llamada existente al `AddEntityFramework` o `AddEntityFrameworkSqlServer`, etc. `AddDbContext` todavía debe usarse en la misma manera que antes.</span><span class="sxs-lookup"><span data-stu-id="289c7-187">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

## <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="289c7-188">Se deben llamar a las bases de datos en memoria</span><span class="sxs-lookup"><span data-stu-id="289c7-188">In-memory databases must be named</span></span>

<span data-ttu-id="289c7-189">Se ha quitado la base de datos en memoria sin nombre global y en su lugar deben denominarse todas las bases de datos en memoria.</span><span class="sxs-lookup"><span data-stu-id="289c7-189">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="289c7-190">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="289c7-190">For example:</span></span>

``` csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="289c7-191">Esto crea y usa una base de datos con el nombre "MyDatabase".</span><span class="sxs-lookup"><span data-stu-id="289c7-191">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="289c7-192">Si `UseInMemoryDatabase` se llama de nuevo con el mismo nombre, a continuación, se usará la misma base de datos en memoria, para que puedan compartirse entre varias instancias de contexto.</span><span class="sxs-lookup"><span data-stu-id="289c7-192">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

## <a name="read-only-api-changes"></a><span data-ttu-id="289c7-193">Cambios en la API de solo lectura</span><span class="sxs-lookup"><span data-stu-id="289c7-193">Read-only API changes</span></span>

<span data-ttu-id="289c7-194">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, y `IsStoreGeneratedAlways` se han obsoleto y se reemplazan por [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) y [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span><span class="sxs-lookup"><span data-stu-id="289c7-194">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) and [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span></span> <span data-ttu-id="289c7-195">Estos comportamientos se aplican a cualquier propiedad (no sólo las propiedades generadas por el almacén) y determinar cómo se debe usar el valor de la propiedad cuando se insertan en una fila de la base de datos (`BeforeSaveBehavior`) o al actualizar una existente base de datos fila (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="289c7-195">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="289c7-196">Las propiedades marcan como [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (por ejemplo, para las columnas calculadas) omitirá de forma predeterminada cualquier valor establecido actualmente en la propiedad.</span><span class="sxs-lookup"><span data-stu-id="289c7-196">Properties marked as [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (for example, for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="289c7-197">Esto significa que siempre se obtendrá un valor generado por el almacén, independientemente de si cualquier valor se ha establecido o modificado en la entidad con seguimiento.</span><span class="sxs-lookup"><span data-stu-id="289c7-197">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="289c7-198">Esto se puede cambiar estableciendo otro `Before\AfterSaveBehavior`.</span><span class="sxs-lookup"><span data-stu-id="289c7-198">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

## <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="289c7-199">Nuevo comportamiento de eliminación ClientSetNull</span><span class="sxs-lookup"><span data-stu-id="289c7-199">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="289c7-200">En versiones anteriores, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) tenía un comportamiento para las entidades seguidas por el contexto que más cerrado coincidente `SetNull` semántica.</span><span class="sxs-lookup"><span data-stu-id="289c7-200">In previous releases, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="289c7-201">En EF Core 2.0, un nuevo `ClientSetNull` comportamiento se ha introducido como el valor predeterminado para las relaciones opcionales.</span><span class="sxs-lookup"><span data-stu-id="289c7-201">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="289c7-202">Este comportamiento tiene `SetNull` semántica para las entidades sometidas a seguimiento y `Restrict` comportamiento para las bases de datos creadas con EF Core.</span><span class="sxs-lookup"><span data-stu-id="289c7-202">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="289c7-203">En nuestra experiencia, estos son los comportamientos más espera/útiles para las entidades sometidas a seguimiento y la base de datos.</span><span class="sxs-lookup"><span data-stu-id="289c7-203">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="289c7-204">`DeleteBehavior.Restrict` Ahora se admite para las entidades sometidas a seguimiento cuando se establece para las relaciones opcionales.</span><span class="sxs-lookup"><span data-stu-id="289c7-204">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

## <a name="provider-design-time-packages-removed"></a><span data-ttu-id="289c7-205">Paquetes de tiempo de diseño del proveedor quitados</span><span class="sxs-lookup"><span data-stu-id="289c7-205">Provider design-time packages removed</span></span>

<span data-ttu-id="289c7-206">El `Microsoft.EntityFrameworkCore.Relational.Design` se ha quitado el paquete.</span><span class="sxs-lookup"><span data-stu-id="289c7-206">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="289c7-207">Su contenido se consolidaron `Microsoft.EntityFrameworkCore.Relational` y `Microsoft.EntityFrameworkCore.Design`.</span><span class="sxs-lookup"><span data-stu-id="289c7-207">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="289c7-208">Esto se propaga a los paquetes de tiempo de diseño de proveedor.</span><span class="sxs-lookup"><span data-stu-id="289c7-208">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="289c7-209">Los paquetes (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) se quitaron y su contenido se consolida en los paquetes de proveedor principal.</span><span class="sxs-lookup"><span data-stu-id="289c7-209">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="289c7-210">Para habilitar `Scaffold-DbContext` o `dotnet ef dbcontext scaffold` en EF Core 2.0, solo deberá hacen referencia al paquete de proveedor único:</span><span class="sxs-lookup"><span data-stu-id="289c7-210">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

``` xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
