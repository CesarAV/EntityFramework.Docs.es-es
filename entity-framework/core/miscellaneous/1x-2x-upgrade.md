---
title: "Actualización desde versiones anteriores a EF Core 2 - Core EF"
author: divega
ms.author: divega
ms.date: 8/13/2017
ms.assetid: 8BD43C8C-63D9-4F3A-B954-7BC518A1B7DB
ms.technology: entity-framework-core
uid: core/miscellaneous/1x-2x-upgrade
ms.openlocfilehash: 380f27c9f00943a2909ec7b876e151572a67dc37
ms.sourcegitcommit: ced2637bf8cc5964c6daa6c7fcfce501bf9ef6e8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 12/22/2017
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="30645-102">Actualizar aplicaciones de versiones anteriores a EF Core 2.0</span><span class="sxs-lookup"><span data-stu-id="30645-102">Upgrading applications from previous versions to EF Core 2.0</span></span>

## <a name="procedures-common-to-all-applications"></a><span data-ttu-id="30645-103">Procedimientos comunes a todas las aplicaciones</span><span class="sxs-lookup"><span data-stu-id="30645-103">Procedures Common to All Applications</span></span>

<span data-ttu-id="30645-104">Puede requerir la actualización de una aplicación existente a EF Core 2.0:</span><span class="sxs-lookup"><span data-stu-id="30645-104">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="30645-105">Actualización de la plataforma de .NET de destino de la aplicación a una que admita el estándar de .NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="30645-105">Upgrading the target .NET platform of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="30645-106">Vea [Supported Platforms](../platforms/index.md) para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="30645-106">See [Supported Platforms](../platforms/index.md) for more details.</span></span>

2. <span data-ttu-id="30645-107">Identificar un proveedor para la base de datos de destino que sea compatible con EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="30645-107">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="30645-108">Vea [EF Core 2.0 requiere un proveedor de base de 2.0 datos](#ef-core-20-requires-a-20-database-provider) a continuación.</span><span class="sxs-lookup"><span data-stu-id="30645-108">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="30645-109">Actualizar todos los paquetes de EF principales (en tiempo de ejecución y herramientas) 2.0.</span><span class="sxs-lookup"><span data-stu-id="30645-109">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="30645-110">Hacer referencia a [instalar EF Core](../get-started/install/index.md) para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="30645-110">Refer to [Installing EF Core](../get-started/install/index.md) for more details.</span></span>

4. <span data-ttu-id="30645-111">Realice los cambios de código necesarios para compensar cambios importantes.</span><span class="sxs-lookup"><span data-stu-id="30645-111">Make any necessary code changes to compensate for breaking changes.</span></span> <span data-ttu-id="30645-112">Consulte la [Breaking Changes](#breaking-changes) sección para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="30645-112">See the [Breaking Changes](#breaking-changes) section below for more details.</span></span>

## <a name="aspnet-core-applications"></a><span data-ttu-id="30645-113">Aplicaciones de ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="30645-113">ASP.NET Core applications</span></span>

1. <span data-ttu-id="30645-114">Vea en particular el [nuevo patrón para inicializar el proveedor de servicio de la aplicación](#new-way-of-getting-application-services) se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="30645-114">See in particular the [new pattern for initializing the application's service provider](#new-way-of-getting-application-services) described below.</span></span>

> [!TIP]  
> <span data-ttu-id="30645-115">La adopción de este nuevo patrón al actualizar las aplicaciones 2.0 es muy recomendable y es necesario para características de producto como Entity Framework Core migraciones para que funcione.</span><span class="sxs-lookup"><span data-stu-id="30645-115">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="30645-116">La otra alternativa común es [implementar *IDesignTimeDbContextFactory\<TContext >*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span><span class="sxs-lookup"><span data-stu-id="30645-116">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span></span>

2. <span data-ttu-id="30645-117">Las aplicaciones para ASP.NET Core 2.0 pueden usar EF Core 2.0 sin dependencias adicionales además de proveedores de bases de datos de terceros.</span><span class="sxs-lookup"><span data-stu-id="30645-117">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="30645-118">Sin embargo, las aplicaciones destinadas a versiones anteriores de ASP.NET Core deben actualizar a ASP.NET Core 2.0 para poder usar EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="30645-118">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="30645-119">Para obtener más información sobre cómo actualizar las aplicaciones principales de ASP.NET 2.0, consulte [la documentación principal de ASP.NET en el asunto](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="30645-119">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="breaking-changes"></a><span data-ttu-id="30645-120">Cambios importantes</span><span class="sxs-lookup"><span data-stu-id="30645-120">Breaking Changes</span></span>

<span data-ttu-id="30645-121">Le hemos llevado la oportunidad para redefinir notablemente nuestra API existentes y los comportamientos en 2.0.</span><span class="sxs-lookup"><span data-stu-id="30645-121">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="30645-122">Existen algunas mejoras que pueden requerir modificar el código de aplicación existente, aunque creemos que para la mayoría de las aplicaciones el impacto será bajo, en la mayoría de los casos que requieren simplemente recompilación y unos cambios mínimos guiados para reemplazar API obsoletas.</span><span class="sxs-lookup"><span data-stu-id="30645-122">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

### <a name="new-way-of-getting-application-services"></a><span data-ttu-id="30645-123">Nueva manera de obtener los servicios de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="30645-123">New way of getting application services</span></span>

<span data-ttu-id="30645-124">Se ha actualizado el patrón recomendado para las aplicaciones web de ASP.NET Core para 2.0 de forma que la lógica de tiempo de diseño que principales de EF utilizada en 1.x se interrumpió.</span><span class="sxs-lookup"><span data-stu-id="30645-124">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="30645-125">Anteriormente en tiempo de diseño, Core EF intentaría invocar `Startup.ConfigureServices` directamente con el fin de obtener acceso a proveedor de servicios de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="30645-125">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="30645-126">En el núcleo de ASP.NET 2.0, se inicializa configuración fuera de la `Startup` clase.</span><span class="sxs-lookup"><span data-stu-id="30645-126">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="30645-127">Las aplicaciones que usan EF Core suelen tener acceso a sus cadenas de conexión de configuración, por lo que `Startup` por sí solo no es suficiente.</span><span class="sxs-lookup"><span data-stu-id="30645-127">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="30645-128">Si actualiza una aplicación de ASP.NET Core 1.x, puede recibir el error siguiente al usar las herramientas de EF Core.</span><span class="sxs-lookup"><span data-stu-id="30645-128">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="30645-129">No se encontró ningún constructor sin parámetros en 'ApplicationContext'.</span><span class="sxs-lookup"><span data-stu-id="30645-129">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="30645-130">Agregue un constructor sin parámetros al 'ApplicationContext' o agregue una implementación de ' IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' en el mismo ensamblado que 'ApplicationContext'</span><span class="sxs-lookup"><span data-stu-id="30645-130">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="30645-131">Se ha agregado un nuevo enlace de tiempo de diseño en la plantilla predeterminada de ASP.NET Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="30645-131">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="30645-132">El método estático `Program.BuildWebHost` método permite que el núcleo de EF acceder al proveedor de servicios de la aplicación en tiempo de diseño.</span><span class="sxs-lookup"><span data-stu-id="30645-132">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="30645-133">Si va a actualizar una aplicación de ASP.NET Core 1.x, debe mantenerlo `Program` clase similares a lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="30645-133">If you are upgrading an ASP.NET Core 1.x application, you will need to update you `Program` class to resemble the following.</span></span>

``` csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

### <a name="idbcontextfactory-renamed"></a><span data-ttu-id="30645-134">Cambiar el nombre de IDbContextFactory</span><span class="sxs-lookup"><span data-stu-id="30645-134">IDbContextFactory renamed</span></span>

<span data-ttu-id="30645-135">Con el fin de admitir patrones de diversas de la aplicación y proporcionar a los usuarios más control sobre cómo sus `DbContext` se utiliza en tiempo de diseño, tenemos, en el pasado, siempre que el `IDbContextFactory<TContext>` interfaz.</span><span class="sxs-lookup"><span data-stu-id="30645-135">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="30645-136">En tiempo de diseño, las herramientas principales de EF detectará las implementaciones de esta interfaz en el proyecto y usarlo para crear `DbContext` objetos.</span><span class="sxs-lookup"><span data-stu-id="30645-136">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="30645-137">Esta interfaz tenía un nombre muy general que desorientar a algunos usuarios para intentar volver a utilizarlo para otros `DbContext`-crear escenarios.</span><span class="sxs-lookup"><span data-stu-id="30645-137">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="30645-138">Se precavido cuando las herramientas de EF, a continuación, intentó usar su implementación en tiempo de diseño y se hizo comandos como `Update-Database` o `dotnet ef database update` un error.</span><span class="sxs-lookup"><span data-stu-id="30645-138">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="30645-139">Para comunicar la semántica de tiempo de diseño segura de esta interfaz, hemos hemos cambiado el nombre a `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="30645-139">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="30645-140">Para la versión 2.0 de la versión de la `IDbContextFactory<TContext>` todavía existe, pero está marcado como obsoleto.</span><span class="sxs-lookup"><span data-stu-id="30645-140">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

### <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="30645-141">Quitar DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="30645-141">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="30645-142">Debido a los cambios de núcleo de ASP.NET 2.0 se ha descrito anteriormente, descubrimos que `DbContextFactoryOptions` ya no se necesita en el nuevo `IDesignTimeDbContextFactory<TContext>` interfaz.</span><span class="sxs-lookup"><span data-stu-id="30645-142">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="30645-143">Estas son las alternativas que se debe usar en su lugar.</span><span class="sxs-lookup"><span data-stu-id="30645-143">Here are the alternatives you should be using instead.</span></span>

<span data-ttu-id="30645-144">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="30645-144">DbContextFactoryOptions</span></span> | <span data-ttu-id="30645-145">Alternativa</span><span class="sxs-lookup"><span data-stu-id="30645-145">Alternative</span></span>
--- | ---
<span data-ttu-id="30645-146">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="30645-146">ApplicationBasePath</span></span> | <span data-ttu-id="30645-147">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="30645-147">AppContext.BaseDirectory</span></span>
<span data-ttu-id="30645-148">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="30645-148">ContentRootPath</span></span> | <span data-ttu-id="30645-149">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="30645-149">Directory.GetCurrentDirectory()</span></span>
<span data-ttu-id="30645-150">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="30645-150">EnvironmentName</span></span> | <span data-ttu-id="30645-151">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="30645-151">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span>

### <a name="design-time-working-directory-changed"></a><span data-ttu-id="30645-152">Cambiar el directorio de trabajo de tiempo de diseño</span><span class="sxs-lookup"><span data-stu-id="30645-152">Design-time working directory changed</span></span>

<span data-ttu-id="30645-153">Los cambios principales de ASP.NET 2.0 también requieren el directorio de trabajo utilizado por `dotnet ef` para alinearse con el directorio de trabajo utilizado por Visual Studio cuando se ejecuta la aplicación.</span><span class="sxs-lookup"><span data-stu-id="30645-153">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="30645-154">Un efecto secundario observable de esto es que SQLite nombres de archivo están ahora en relación con el directorio del proyecto y no en el directorio de salida como solía ser.</span><span class="sxs-lookup"><span data-stu-id="30645-154">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

### <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="30645-155">EF Core 2.0 requiere un proveedor de base de 2.0 datos</span><span class="sxs-lookup"><span data-stu-id="30645-155">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="30645-156">Para EF Core 2.0 hemos realizado muchas mejoras en los proveedores de base de datos de manera y simplificación de trabajo.</span><span class="sxs-lookup"><span data-stu-id="30645-156">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="30645-157">Esto significa que los proveedores 1.0. x y 1.1.x no funcionará con EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="30645-157">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="30645-158">Los proveedores de SQL Server y SQLite se distribuyen por el equipo de EF y 2.0 versiones estarán disponibles como parte de la versión 2.0 de la versión.</span><span class="sxs-lookup"><span data-stu-id="30645-158">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="30645-159">Los proveedores de código abierto de terceros para [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), y [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) se actualizan para 2.0.</span><span class="sxs-lookup"><span data-stu-id="30645-159">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="30645-160">Para todos los otros proveedores, póngase en contacto con el sistema de escritura de proveedor.</span><span class="sxs-lookup"><span data-stu-id="30645-160">For all other providers, please contact the provider writer.</span></span>

### <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="30645-161">Eventos de registro y diagnóstico han cambiado</span><span class="sxs-lookup"><span data-stu-id="30645-161">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="30645-162">Nota: estos cambios no deberían afectar la mayoría del código de aplicación.</span><span class="sxs-lookup"><span data-stu-id="30645-162">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="30645-163">Los identificadores de evento para los mensajes enviados a un [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) han cambiado en 2.0.</span><span class="sxs-lookup"><span data-stu-id="30645-163">The event IDs for messages sent to an [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) have changed in 2.0.</span></span> <span data-ttu-id="30645-164">Los identificadores de evento ahora son únicos en el código de EF Core.</span><span class="sxs-lookup"><span data-stu-id="30645-164">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="30645-165">Ahora, estos mensajes también siguen el patrón estándar de registro estructurado que usa, por ejemplo, MVC.</span><span class="sxs-lookup"><span data-stu-id="30645-165">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="30645-166">Las categorías de registrador también han cambiado.</span><span class="sxs-lookup"><span data-stu-id="30645-166">Logger categories have also changed.</span></span> <span data-ttu-id="30645-167">Ahora hay un conjunto conocido de categorías a las que se accede a través de [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span><span class="sxs-lookup"><span data-stu-id="30645-167">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="30645-168">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) eventos ahora utilizan los mismos nombres de Id. de evento como el correspondiente `ILogger` mensajes.</span><span class="sxs-lookup"><span data-stu-id="30645-168">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="30645-169">Las cargas del evento son todos los tipos nominales derivados [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span><span class="sxs-lookup"><span data-stu-id="30645-169">The event payloads are all nominal types derived from [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span></span>

<span data-ttu-id="30645-170">Id. de evento, tipos de carga y categorías se documentan en el [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) y [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) clases.</span><span class="sxs-lookup"><span data-stu-id="30645-170">Event IDs, payload types, and categories are documented in the [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) and the [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) classes.</span></span>

<span data-ttu-id="30645-171">Id. también ha movido desde Microsoft.EntityFrameworkCore.Infraestructure para el nuevo espacio de nombres Microsoft.EntityFrameworkCore.Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="30645-171">IDs have also moved from Microsoft.EntityFrameworkCore.Infraestructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

### <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="30645-172">Cambios de metadatos relacionales API principales EF</span><span class="sxs-lookup"><span data-stu-id="30645-172">EF Core relational metadata API changes</span></span>

<span data-ttu-id="30645-173">EF Core 2.0 ahora compila un elemento [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) diferente para cada proveedor que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="30645-173">EF Core 2.0 will now build a different [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) for each different provider being used.</span></span> <span data-ttu-id="30645-174">Esto suele ser transparente para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="30645-174">This is usually transparent to the application.</span></span> <span data-ttu-id="30645-175">Esto ha permitido una simplificación de las API de metadatos de nivel inferior, de modo que cualquier acceso a _conceptos de metadatos relacionales comunes_ siempre se realiza mediante una llamada a `.Relational` en lugar de a `.SqlServer`, `.Sqlite`, etc. Por ejemplo, 1.1.x código similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="30645-175">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="30645-176">Ahora debe escribirse como el siguiente:</span><span class="sxs-lookup"><span data-stu-id="30645-176">Should now be written like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="30645-177">En lugar de usar métodos como `ForSqlServerToTable`, métodos de extensión ahora están disponibles para escribir código condicional basado en el proveedor actual en uso.</span><span class="sxs-lookup"><span data-stu-id="30645-177">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="30645-178">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="30645-178">For example:</span></span>

```C#
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="30645-179">Tenga en cuenta que este cambio sólo se aplica a las API y metadatos que se define para _todos los_ proveedores relacional.</span><span class="sxs-lookup"><span data-stu-id="30645-179">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="30645-180">La API y los metadatos permanece invariable cuando es específico a solo un único proveedor.</span><span class="sxs-lookup"><span data-stu-id="30645-180">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="30645-181">Por ejemplo, los índices agrupados son específicos de SQL Server, por lo que `ForSqlServerIsClustered` y `.SqlServer().IsClustered()` debe seguir usándose.</span><span class="sxs-lookup"><span data-stu-id="30645-181">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

### <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="30645-182">No tome el control del proveedor de servicios EF</span><span class="sxs-lookup"><span data-stu-id="30645-182">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="30645-183">EF Core utiliza un interno `IServiceProvider` (es decir, un contenedor de inyección de dependencia) para su implementación interna.</span><span class="sxs-lookup"><span data-stu-id="30645-183">EF Core uses an internal `IServiceProvider` (i.e. a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="30645-184">Las aplicaciones deben permitir EF principal crear y administrar este proveedor excepto en casos especiales.</span><span class="sxs-lookup"><span data-stu-id="30645-184">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="30645-185">Considerar seriamente la posibilidad de quitar todas las llamadas a `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="30645-185">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="30645-186">Si una aplicación necesita llamar a `UseInternalServiceProvider`, a continuación, considere la posibilidad de [presentar un problema](https://github.com/aspnet/EntityFramework/Issues) que nos permita investigar otras formas de controlar el escenario.</span><span class="sxs-lookup"><span data-stu-id="30645-186">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/aspnet/EntityFramework/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="30645-187">Al llamar a `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. no es necesario el código de aplicación a menos que `UseInternalServiceProvider` también se denomina.</span><span class="sxs-lookup"><span data-stu-id="30645-187">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="30645-188">Quite todas las llamadas existentes a `AddEntityFramework` o `AddEntityFrameworkSqlServer`, etc. `AddDbContext` todavía debe usarse en la misma manera que antes.</span><span class="sxs-lookup"><span data-stu-id="30645-188">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

### <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="30645-189">Deben denominarse bases de datos en memoria</span><span class="sxs-lookup"><span data-stu-id="30645-189">In-memory databases must be named</span></span>

<span data-ttu-id="30645-190">Se ha quitado la base de datos en memoria sin nombre global y en su lugar deben denominarse todas las bases de datos en memoria.</span><span class="sxs-lookup"><span data-stu-id="30645-190">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="30645-191">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="30645-191">For example:</span></span>

``` csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="30645-192">Esto crea y usa una base de datos con el nombre "MyDatabase".</span><span class="sxs-lookup"><span data-stu-id="30645-192">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="30645-193">Si `UseInMemoryDatabase` se llama de nuevo con el mismo nombre, se utilizará la misma base de datos en memoria, lo que le permite ser compartida por varias instancias de contexto.</span><span class="sxs-lookup"><span data-stu-id="30645-193">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

### <a name="read-only-api-changes"></a><span data-ttu-id="30645-194">Cambios en la API de solo lectura</span><span class="sxs-lookup"><span data-stu-id="30645-194">Read-only API changes</span></span>

<span data-ttu-id="30645-195">`IsReadOnlyBeforeSave`, `IsReadOnlyAferSave`, y `IsStoreGeneratedAlways` se han obsoleta y se ha reemplazado por [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) y [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span><span class="sxs-lookup"><span data-stu-id="30645-195">`IsReadOnlyBeforeSave`, `IsReadOnlyAferSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) and [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span></span> <span data-ttu-id="30645-196">Estos comportamientos se aplican a cualquier propiedad (no sólo las propiedades generadas por el almacenamiento) y determinar cómo se debe usar el valor de la propiedad al insertar en una fila de la base de datos (`BeforeSaveBehavior`) o al actualizar a otra base de datos fila (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="30645-196">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="30645-197">Propiedades marcadas como [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (por ejemplo, para las columnas calculadas) predeterminada omitirá cualquier valor establecido actualmente en la propiedad.</span><span class="sxs-lookup"><span data-stu-id="30645-197">Properties marked as [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (e.g. for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="30645-198">Esto significa que un valor generado por el almacén se obtendrán siempre, independientemente de si se ha establecido o modificado en la entidad de seguimiento cualquier valor.</span><span class="sxs-lookup"><span data-stu-id="30645-198">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="30645-199">Esto se puede cambiar estableciendo otro `Before\AfterSaveBehavior`.</span><span class="sxs-lookup"><span data-stu-id="30645-199">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

### <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="30645-200">Nuevo comportamiento de eliminación de ClientSetNull</span><span class="sxs-lookup"><span data-stu-id="30645-200">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="30645-201">En versiones anteriores, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) tenía un comportamiento de entidades hace un seguimiento mediante el contexto que más cerrado coincidente `SetNull` semántica.</span><span class="sxs-lookup"><span data-stu-id="30645-201">In previous releases, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="30645-202">En EF Core 2.0, un nuevo `ClientSetNull` comportamiento se ha introducido como el valor predeterminado para las relaciones opcionales.</span><span class="sxs-lookup"><span data-stu-id="30645-202">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="30645-203">Este comportamiento tiene `SetNull` semántica para entidades sometidas a seguimiento y `Restrict` comportamiento para bases de datos creadas mediante el uso EF Core.</span><span class="sxs-lookup"><span data-stu-id="30645-203">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="30645-204">En nuestra experiencia, estos son los comportamientos más espera/útiles para entidades sometidas a seguimiento y la base de datos.</span><span class="sxs-lookup"><span data-stu-id="30645-204">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="30645-205">`DeleteBehavior.Restrict`Ahora se admite para las entidades de seguimiento cuando se establece por relaciones opcionales.</span><span class="sxs-lookup"><span data-stu-id="30645-205">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

### <a name="provider-design-time-packages-removed"></a><span data-ttu-id="30645-206">Paquetes de tiempo de diseño de proveedor quitados</span><span class="sxs-lookup"><span data-stu-id="30645-206">Provider design-time packages removed</span></span>

<span data-ttu-id="30645-207">El `Microsoft.EntityFrameworkCore.Relational.Design` se ha quitado el paquete.</span><span class="sxs-lookup"><span data-stu-id="30645-207">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="30645-208">Su contenido se consolida en `Microsoft.EntityFrameworkCore.Relational` y `Microsoft.EntityFrameworkCore.Design`.</span><span class="sxs-lookup"><span data-stu-id="30645-208">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="30645-209">Esto se propaga a los paquetes de tiempo de diseño de proveedor.</span><span class="sxs-lookup"><span data-stu-id="30645-209">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="30645-210">Los paquetes (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) se quitaron y su contenido se consolida en los paquetes de proveedores principal.</span><span class="sxs-lookup"><span data-stu-id="30645-210">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="30645-211">Para habilitar `Scaffold-DbContext` o `dotnet ef dbcontext scaffold` en EF Core 2.0, solo necesita hacen referencia al paquete de proveedor único:</span><span class="sxs-lookup"><span data-stu-id="30645-211">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

``` xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
