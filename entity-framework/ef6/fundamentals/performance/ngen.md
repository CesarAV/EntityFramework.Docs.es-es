---
title: Mejorar el rendimiento de inicio con NGen - EF6
author: divega
ms.date: 10/23/2016
ms.assetid: dc6110a0-80a0-4370-8190-cea942841cee
ms.openlocfilehash: 2e9a93c7741046da25b890fed084a6b280bf5643
ms.sourcegitcommit: 2b787009fd5be5627f1189ee396e708cd130e07b
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/13/2018
ms.locfileid: "45489965"
---
# <a name="improving-startup-performance-with-ngen"></a><span data-ttu-id="1a94d-102">Mejorar el rendimiento de inicio con NGen</span><span class="sxs-lookup"><span data-stu-id="1a94d-102">Improving startup performance with NGen</span></span>
> [!NOTE]
> <span data-ttu-id="1a94d-103">**Solo EF6 y versiones posteriores**: las características, las API, etc. que se tratan en esta página se han incluido a partir de Entity Framework 6.</span><span class="sxs-lookup"><span data-stu-id="1a94d-103">**EF6 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 6.</span></span> <span data-ttu-id="1a94d-104">Si usa una versión anterior, no se aplica parte o la totalidad de la información.</span><span class="sxs-lookup"><span data-stu-id="1a94d-104">If you are using an earlier version, some or all of the information does not apply.</span></span>  

<span data-ttu-id="1a94d-105">.NET Framework admite la generación de imágenes nativas para las aplicaciones administradas y las bibliotecas como una manera de ayudar a las aplicaciones de inicio más rápido y también en algunos casos usan menos memoria.</span><span class="sxs-lookup"><span data-stu-id="1a94d-105">The .NET Framework supports the generation of native images for managed applications and libraries as a way to help applications start faster and also in some cases use less memory.</span></span> <span data-ttu-id="1a94d-106">Las imágenes nativas se crean mediante la traducción de los ensamblados de código administrado en archivos que contienen instrucciones máquina nativas antes de ejecuta la aplicación, lo cual elimina la necesidad de generar las instrucciones nativas en el compilador JIT (Just-In-Time) de .NET tiempo de ejecución de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1a94d-106">Native images are created by translating managed code assemblies into files containing native machine instructions before the application is executed, relieving the .NET JIT (Just-In-Time) compiler from having to generate the native instructions at application runtime.</span></span>  

<span data-ttu-id="1a94d-107">Antes de la versión 6, bibliotecas del runtime EF core formaban parte de .NET Framework y las imágenes nativas generadas automáticamente para ellos.</span><span class="sxs-lookup"><span data-stu-id="1a94d-107">Prior to version 6, the EF runtime’s core libraries were part of the .NET Framework and native images were generated automatically for them.</span></span> <span data-ttu-id="1a94d-108">Comenzando con la versión 6 se ha combinado el tiempo de ejecución EF todo en el paquete EntityFramework NuGet.</span><span class="sxs-lookup"><span data-stu-id="1a94d-108">Starting with version 6 the whole EF runtime has been combined into the EntityFramework NuGet package.</span></span> <span data-ttu-id="1a94d-109">Las imágenes nativas hasta ahora se generaron mediante la herramienta de línea de comandos de NGen.exe para obtener resultados similares.</span><span class="sxs-lookup"><span data-stu-id="1a94d-109">Native images have to now be generated using the NGen.exe command line tool to obtain similar results.</span></span>  

<span data-ttu-id="1a94d-110">Observaciones empíricas muestran que las imágenes nativas de los ensamblados en tiempo de ejecución EF pueden cortar entre 1 y 3 segundos de tiempo de inicio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1a94d-110">Empirical observations show that native images of the EF runtime assemblies can cut between 1 and 3 seconds of application startup time.</span></span>  

## <a name="how-to-use-ngenexe"></a><span data-ttu-id="1a94d-111">Uso de NGen.exe</span><span class="sxs-lookup"><span data-stu-id="1a94d-111">How to use NGen.exe</span></span>  

<span data-ttu-id="1a94d-112">La función de la herramienta NGen.exe más básica consiste en "install" (es decir, para crear y guardar en disco) las imágenes nativas para un ensamblado y todas sus dependencias directas.</span><span class="sxs-lookup"><span data-stu-id="1a94d-112">The most basic function of the NGen.exe tool is to “install” (that is, to create and persist to disk) native images for an assembly and all its direct dependencies.</span></span> <span data-ttu-id="1a94d-113">Le mostramos cómo hacerlo:</span><span class="sxs-lookup"><span data-stu-id="1a94d-113">Here is how you can achieve that:</span></span>  

1. <span data-ttu-id="1a94d-114">Abra una ventana del símbolo del sistema como administrador</span><span class="sxs-lookup"><span data-stu-id="1a94d-114">Open a Command Prompt window as an administrator</span></span>  
2. <span data-ttu-id="1a94d-115">Cambie el directorio de trabajo actual a la ubicación de los ensamblados que desea generar imágenes nativas para:</span><span class="sxs-lookup"><span data-stu-id="1a94d-115">Change the current working directory to the location of the assemblies you want to generate native images for:</span></span>  

  ``` console
    cd <*Assemblies location*>  
  ```
3. <span data-ttu-id="1a94d-116">Dependiendo de su sistema operativo y configuración de la aplicación deba genera imágenes nativas para la arquitectura de 32 bits, la arquitectura de 64 bits o ambos.</span><span class="sxs-lookup"><span data-stu-id="1a94d-116">Depending on your operating system and the application’s configuration you might need to generate native images for 32 bit architecture, 64 bit architecture or for both.</span></span>  

    <span data-ttu-id="1a94d-117">Para 32 bits que ejecute:</span><span class="sxs-lookup"><span data-stu-id="1a94d-117">For 32 bit run:</span></span>  
  ``` console
    %WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install <Assembly name>  
  ```
    <span data-ttu-id="1a94d-118">Para ejecutar de 64 bits:</span><span class="sxs-lookup"><span data-stu-id="1a94d-118">For 64 bit run:</span></span>
  ``` console
    %WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install <Assembly name>  
  ```

> [!TIP]
> <span data-ttu-id="1a94d-119">Generación de imágenes nativas para la arquitectura incorrecta es un error muy común.</span><span class="sxs-lookup"><span data-stu-id="1a94d-119">Generating native images for the wrong architecture is a very common mistake.</span></span> <span data-ttu-id="1a94d-120">En caso de duda, simplemente puede generar imágenes nativas para todas las arquitecturas que se aplican al sistema operativo instalado en la máquina.</span><span class="sxs-lookup"><span data-stu-id="1a94d-120">When in doubt you can simply generate native images for all the architectures that apply to the operating system installed in the machine.</span></span>  

<span data-ttu-id="1a94d-121">NGen.exe también admite otras funciones como la desinstalación y mostrar las imágenes nativas instaladas, puesta en cola la generación de varias imágenes, etcetera. Para obtener más detalles de uso de leer el [NGen.exe documentación](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span><span class="sxs-lookup"><span data-stu-id="1a94d-121">NGen.exe also supports other functions such as uninstalling and displaying the installed native images, queuing the generation of multiple images, etc. For more details of usage read the [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span></span>  

## <a name="when-to-use-ngenexe"></a><span data-ttu-id="1a94d-122">Cuándo utilizar NGen.exe</span><span class="sxs-lookup"><span data-stu-id="1a94d-122">When to use NGen.exe</span></span>  

<span data-ttu-id="1a94d-123">Cuando se trata de decidir qué ensamblados para generar imágenes nativas en una aplicación basada en EF versión 6 o posterior, debe considerar las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="1a94d-123">When it comes to decide which assemblies to generate native images for in an application based on EF version 6 or greater, you should consider the following options:</span></span>  

- <span data-ttu-id="1a94d-124">**El ensamblado principal de tiempo de ejecución EF, EntityFramework.dll**: una aplicación típica de EF en función ejecuta una cantidad significativa de código de este ensamblado en el inicio o en el primer acceso a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="1a94d-124">**The main EF runtime assembly, EntityFramework.dll**: A typical EF based application executes a significant amount of code from this assembly on startup or on its first access to the database.</span></span> <span data-ttu-id="1a94d-125">Por lo tanto, crear imágenes nativas de este ensamblado generará las mayores ganancias en el rendimiento de inicio.</span><span class="sxs-lookup"><span data-stu-id="1a94d-125">Consequently, creating native images of this assembly will produce the biggest gains in startup performance.</span></span>  
- <span data-ttu-id="1a94d-126">**La aplicación usado cualquier ensamblado del proveedor EF**: tiempo de inicio también puede beneficiarse ligeramente para generar imágenes nativas de estos.</span><span class="sxs-lookup"><span data-stu-id="1a94d-126">**Any EF provider assembly used by your application**: Startup time can also benefit slightly from generating native images of these.</span></span> <span data-ttu-id="1a94d-127">Por ejemplo, si la aplicación utiliza el proveedor EF para SQL Server que desee generar una imagen nativa para EntityFramework.SqlServer.dll.</span><span class="sxs-lookup"><span data-stu-id="1a94d-127">For example, if the application uses the EF provider for SQL Server you will want to generate a native image for EntityFramework.SqlServer.dll.</span></span>  
- <span data-ttu-id="1a94d-128">**Ensamblados de la aplicación y otras dependencias**: el [NGen.exe documentación](https://msdn.microsoft.com/library/6t9t5wcf.aspx) cubre criterios generales para elegir qué ensamblados para generar imágenes nativas para y el impacto de las imágenes nativas en la seguridad Opciones avanzadas como "enlace fuerte," escenarios como el uso de imágenes nativas de depuración y generación de perfiles de escenarios, etcetera.</span><span class="sxs-lookup"><span data-stu-id="1a94d-128">**Your application’s assemblies and other dependencies**: The [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) covers general criteria for choosing which assemblies to generate native images for and the impact of native images on security, advanced options such as “hard binding”, scenarios such as using native images in debugging and profiling scenarios, etc.</span></span>  

> [!TIP]
> <span data-ttu-id="1a94d-129">Asegúrese de medir el impacto del uso de las imágenes nativas en el rendimiento de inicio y el rendimiento general de la aplicación con cuidado y compárelos con los requisitos reales.</span><span class="sxs-lookup"><span data-stu-id="1a94d-129">Make sure you carefully measure the impact of using native images on both the startup performance and the overall performance of your application and compare them against actual requirements.</span></span> <span data-ttu-id="1a94d-130">Mientras que las imágenes nativas con carácter general le ayudará a mejorar el inicio, el rendimiento y reducir el uso de memoria en algunos casos, no todos los escenarios se beneficiarán igualmente.</span><span class="sxs-lookup"><span data-stu-id="1a94d-130">While native images will generally help improve startup up performance and in some cases reduce memory usage, not all scenarios will benefit equally.</span></span> <span data-ttu-id="1a94d-131">Por ejemplo, en la ejecución de estado estable (es decir, una vez que se han invocado todos los métodos de la aplicación está usando al menos una vez) código generado por el compilador JIT puede en realidad producen un rendimiento ligeramente mejor que las imágenes nativas.</span><span class="sxs-lookup"><span data-stu-id="1a94d-131">For instance, on steady state execution (that is, once all the methods being used by the application have been invoked at least once) code generated by the JIT compiler can in fact yield slightly better performance than native images.</span></span>  

## <a name="using-ngenexe-in-a-development-machine"></a><span data-ttu-id="1a94d-132">Uso de NGen.exe en una máquina de desarrollo</span><span class="sxs-lookup"><span data-stu-id="1a94d-132">Using NGen.exe in a development machine</span></span>  

<span data-ttu-id="1a94d-133">Durante el desarrollo, el compilador JIT de .NET compilador ofrecerá el mejor equilibrio general para el código que cambia con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="1a94d-133">During development the .NET JIT compiler will offer the best overall tradeoff for code that is changing frequently.</span></span> <span data-ttu-id="1a94d-134">Generación de imágenes nativas para dependencias compiladas como los ensamblados en tiempo de ejecución EF puede ayudar a acelerar el desarrollo y pruebas si recortar unos pocos segundos al principio de cada ejecución.</span><span class="sxs-lookup"><span data-stu-id="1a94d-134">Generating native images for compiled dependencies such as the EF runtime assemblies can help accelerate development and testing by cutting a few seconds out at the beginning of each execution.</span></span>  

<span data-ttu-id="1a94d-135">Un buen lugar para encontrar los ensamblados en tiempo de ejecución EF es la ubicación del paquete NuGet para la solución.</span><span class="sxs-lookup"><span data-stu-id="1a94d-135">A good place to find the EF runtime assemblies is the NuGet package location for the solution.</span></span> <span data-ttu-id="1a94d-136">Por ejemplo, para una aplicación mediante EF 6.0.2 con SQL Server y destinadas a .NET 4.5 o superior puede escribir lo siguiente en una ventana del símbolo del sistema (no olvide abrirlo como administrador):</span><span class="sxs-lookup"><span data-stu-id="1a94d-136">For example, for an application using EF 6.0.2 with SQL Server and targeting .NET 4.5 or greater you can type the following in a Command Prompt window (remember to open it as an administrator):</span></span>  

``` console
cd <Solution directory>\packages\EntityFramework.6.0.2\lib\net45
%WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install EntityFramework.SqlServer.dll
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install EntityFramework.SqlServer.dll
```  

> [!NOTE]
> <span data-ttu-id="1a94d-137">Esto aprovecha el hecho de que la instalación de las imágenes nativas para el proveedor EF para SQL Server también de forma predeterminada instalará las imágenes nativas para el ensamblado en tiempo de ejecución EF principal.</span><span class="sxs-lookup"><span data-stu-id="1a94d-137">This takes advantage of the fact that installing the native images for EF provider for SQL Server will also by default install the native images for the main EF runtime assembly.</span></span> <span data-ttu-id="1a94d-138">Esto funciona porque NGen.exe puede detectar que EntityFramework.dll es una dependencia directa del ensamblado EntityFramework.SqlServer.dll ubicado en el mismo directorio.</span><span class="sxs-lookup"><span data-stu-id="1a94d-138">This works because NGen.exe can detect that EntityFramework.dll is a direct dependency of the EntityFramework.SqlServer.dll assembly located in the same directory.</span></span>  

## <a name="creating-native-images-during-setup"></a><span data-ttu-id="1a94d-139">Crear imágenes nativas durante la instalación</span><span class="sxs-lookup"><span data-stu-id="1a94d-139">Creating native images during setup</span></span>  

<span data-ttu-id="1a94d-140">El WiX Toolkit admite puesta en cola la generación de imágenes nativas para los ensamblados administrados durante la instalación, como se explica en este [guía](http://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span><span class="sxs-lookup"><span data-stu-id="1a94d-140">The WiX Toolkit supports queuing the generation of native images for managed assemblies during setup, as explained in this [how-to guide](http://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span></span> <span data-ttu-id="1a94d-141">Otra alternativa consiste en crear una tarea de instalación personalizada que ejecute el comando de NGen.exe.</span><span class="sxs-lookup"><span data-stu-id="1a94d-141">Another alternative is to create a custom setup task that execute the NGen.exe command.</span></span>  

## <a name="verifying-that-native-images-are-being-used-for-ef"></a><span data-ttu-id="1a94d-142">Comprobando que las imágenes nativas se utilizan para EF</span><span class="sxs-lookup"><span data-stu-id="1a94d-142">Verifying that native images are being used for EF</span></span>  

<span data-ttu-id="1a94d-143">Puede comprobar que una aplicación específica utiliza un ensamblado nativo mediante la búsqueda de los ensamblados cargados que tienen la extensión ". ni.dll"o". ni.exe".</span><span class="sxs-lookup"><span data-stu-id="1a94d-143">You can verify that a specific application is using a native assembly by looking for loaded assemblies that have the extension “.ni.dll” or “.ni.exe”.</span></span> <span data-ttu-id="1a94d-144">Por ejemplo, una imagen nativa para el ensamblado de tiempo de ejecución principal de EF se llamará EntityFramework.ni.dll.</span><span class="sxs-lookup"><span data-stu-id="1a94d-144">For example, a native image for the EF’s main runtime assembly will be called EntityFramework.ni.dll.</span></span> <span data-ttu-id="1a94d-145">Una manera fácil de inspeccionar los ensamblados .NET cargados de un proceso es usar [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span><span class="sxs-lookup"><span data-stu-id="1a94d-145">An easy way to inspect the loaded .NET assemblies of a process is to use [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span></span>  

## <a name="other-things-to-be-aware-of"></a><span data-ttu-id="1a94d-146">Otras cosas a tener en cuenta</span><span class="sxs-lookup"><span data-stu-id="1a94d-146">Other things to be aware of</span></span>  

<span data-ttu-id="1a94d-147">**Creación de una imagen nativa de un ensamblado no debe confundirse con el registro del ensamblado en el [GAC (caché Global de ensamblados)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span><span class="sxs-lookup"><span data-stu-id="1a94d-147">**Creating a native image of an assembly should not be confused with registering the assembly in the [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span></span> <span data-ttu-id="1a94d-148">NGen.exe permite la creación de imágenes de los ensamblados que no están en la GAC y, de hecho, varias aplicaciones que utilizan una versión concreta de EF pueden compartir la misma imagen nativa.</span><span class="sxs-lookup"><span data-stu-id="1a94d-148">NGen.exe allows creating images of assemblies that are not in the GAC, and in fact, multiple applications that use a specific version of EF can share the same native image.</span></span> <span data-ttu-id="1a94d-149">Aunque Windows 8 puede crear automáticamente las imágenes nativas para los ensamblados ubicados en la GAC, el tiempo de ejecución EF está optimizado para implementarse junto con la aplicación y no se recomienda registrarlo en la GAC esto tiene un impacto negativo en la resolución de ensamblado y las aplicaciones, entre otros aspectos de mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="1a94d-149">While Windows 8 can automatically create native images for assemblies placed in the GAC, the EF runtime is optimized to be deployed alongside your application and we do not recommend registering it in the GAC as this has a negative impact on assembly resolution and servicing your applications among other aspects.</span></span>  
