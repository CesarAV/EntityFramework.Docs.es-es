---
title: El modelo de proveedor de Entity Framework 6 - EF6
author: divega
ms.date: 2018-06-27
ms.assetid: 066832F0-D51B-4655-8BE7-C983C557E0E4
ms.openlocfilehash: 7d9e2f49b9ef59fb63b024646911ec0d8dfcfc60
ms.sourcegitcommit: 0d36e8ff0892b7f034b765b15e041f375f88579a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/09/2018
ms.locfileid: "44251109"
---
# <a name="the-entity-framework-6-provider-model"></a><span data-ttu-id="8b424-102">El modelo de proveedor de Entity Framework 6</span><span class="sxs-lookup"><span data-stu-id="8b424-102">The Entity Framework 6 provider model</span></span>

<span data-ttu-id="8b424-103">El modelo de proveedor de Entity Framework permite a Entity Framework para su uso con distintos tipos de servidor de base de datos.</span><span class="sxs-lookup"><span data-stu-id="8b424-103">The Entity Framework provider model allows Entity Framework to be used with different types of database server.</span></span> <span data-ttu-id="8b424-104">Por ejemplo, un proveedor puede estar conectado para permitir que EF para usarse con Microsoft SQL Server, aunque se puede conectar a otro proveedor para permitir que EF para usarse con Microsoft SQL Server Compact Edition.</span><span class="sxs-lookup"><span data-stu-id="8b424-104">For example, one provider can be plugged in to allow EF to be used against Microsoft SQL Server, while another provider can be plugged into to allow EF to be used against Microsoft SQL Server Compact Edition.</span></span> <span data-ttu-id="8b424-105">Los proveedores de EF6 que somos conscientes de pueden encontrarse en el [proveedores de Entity Framework](~/ef6/fundamentals/providers/index.md) página.</span><span class="sxs-lookup"><span data-stu-id="8b424-105">The providers for EF6 that we are aware of can be found on the [Entity Framework providers](~/ef6/fundamentals/providers/index.md) page.</span></span>

<span data-ttu-id="8b424-106">Ciertos cambios eran necesarios a la forma en que EF interactúa con proveedores para permitir que EF liberarse bajo una licencia de código abierto.</span><span class="sxs-lookup"><span data-stu-id="8b424-106">Certain changes were required to the way EF interacts with providers to allow EF to be released under an open source license.</span></span> <span data-ttu-id="8b424-107">Estos cambios requieren la regeneración de los proveedores EF con los ensamblados de EF6 junto con los nuevos mecanismos de registro del proveedor.</span><span class="sxs-lookup"><span data-stu-id="8b424-107">These changes require rebuilding of EF providers against the EF6 assemblies together with new mechanisms for registration of the provider.</span></span>

## <a name="rebuilding"></a><span data-ttu-id="8b424-108">Volver a generar</span><span class="sxs-lookup"><span data-stu-id="8b424-108">Rebuilding</span></span>

<span data-ttu-id="8b424-109">Con EF6 ahora se incluye el código principal que anteriormente formaba parte de .NET Framework como ensamblados de fuera de banda (OOB).</span><span class="sxs-lookup"><span data-stu-id="8b424-109">With EF6 the core code that was previously part of the .NET Framework is now being shipped as out-of-band (OOB) assemblies.</span></span> <span data-ttu-id="8b424-110">Encontrará más información sobre cómo crear aplicaciones para EF6 en el [actualizar las aplicaciones para EF6](~/ef6/what-is-new/upgrading-to-ef6.md) página.</span><span class="sxs-lookup"><span data-stu-id="8b424-110">Details on how to build applications against EF6 can be found on the [Updating applications for EF6](~/ef6/what-is-new/upgrading-to-ef6.md) page.</span></span> <span data-ttu-id="8b424-111">Los proveedores también necesitará volver a generar usando estas instrucciones.</span><span class="sxs-lookup"><span data-stu-id="8b424-111">Providers will also need to be rebuilt using these instructions.</span></span>

## <a name="provider-types-overview"></a><span data-ttu-id="8b424-112">Información general sobre tipos de proveedor</span><span class="sxs-lookup"><span data-stu-id="8b424-112">Provider types overview</span></span>

<span data-ttu-id="8b424-113">Un proveedor de EF es realmente una colección de servicios específicos del proveedor definidos por los tipos CLR que estos servicios se extienden desde (para una clase base) o se implementan (para una interfaz).</span><span class="sxs-lookup"><span data-stu-id="8b424-113">An EF provider is really a collection of provider-specific services defined by CLR types that these services extend from (for a base class) or implement (for an interface).</span></span> <span data-ttu-id="8b424-114">Dos de estos servicios son fundamentales y es necesario para EF funcione en absoluto.</span><span class="sxs-lookup"><span data-stu-id="8b424-114">Two of these services are fundamental and necessary for EF to function at all.</span></span> <span data-ttu-id="8b424-115">Otros son opcionales y solo es necesario implementar si se requiere una funcionalidad específica o las implementaciones predeterminadas de estos servicios no funciona para el servidor de base de datos específica usando como objetivo.</span><span class="sxs-lookup"><span data-stu-id="8b424-115">Others are optional and only need to be implemented if specific functionality is required and/or the default implementations of these services does not work for the specific database server being targeted.</span></span>

## <a name="fundamental-provider-types"></a><span data-ttu-id="8b424-116">Tipos fundamentales de proveedor</span><span class="sxs-lookup"><span data-stu-id="8b424-116">Fundamental provider types</span></span>

### <a name="dbproviderfactory"></a><span data-ttu-id="8b424-117">DbProviderFactory</span><span class="sxs-lookup"><span data-stu-id="8b424-117">DbProviderFactory</span></span>

<span data-ttu-id="8b424-118">EF depende de si hay un tipo derivado de [System.Data.Common.DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx) para llevar a cabo todo el acceso de bajo nivel de base de datos.</span><span class="sxs-lookup"><span data-stu-id="8b424-118">EF depends on having a type derived from [System.Data.Common.DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx) for performing all low-level database access.</span></span> <span data-ttu-id="8b424-119">No es parte de EF DbProviderFactory sino que es una clase en .NET Framework que actúa un punto de entrada para los proveedores ADO.NET que puede utilizarse por EF, otra Micro-o/RM o directamente por una aplicación para obtener instancias de las conexiones, comandos, parámetros y otras abstracciones de ADO.NET en un proveedor de manera independiente.</span><span class="sxs-lookup"><span data-stu-id="8b424-119">DbProviderFactory is not actually part of EF but is instead a class in the .NET Framework that serves an entry point for ADO.NET providers that can be used by EF, other O/RMs or directly by an application to obtain instances of connections, commands, parameters and other ADO.NET abstractions in a provider agnostic way.</span></span> <span data-ttu-id="8b424-120">Para obtener más información sobre el objeto DbProviderFactory una se encuentra en la [documentación de MSDN para ADO.NET](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx).</span><span class="sxs-lookup"><span data-stu-id="8b424-120">More information about DbProviderFactory an be found in the [MSDN documentation for ADO.NET](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx).</span></span>

### <a name="dbproviderservices"></a><span data-ttu-id="8b424-121">DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="8b424-121">DbProviderServices</span></span>

<span data-ttu-id="8b424-122">EF depende de si hay un tipo derivado de DbProviderServices para proporcionar funcionalidad adicional necesaria para EF encima de la funcionalidad ya proporcionada por el proveedor de ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="8b424-122">EF depends on having a type derived from DbProviderServices for providing additional functionality needed by EF on top of the functionality already provided by the ADO.NET provider.</span></span> <span data-ttu-id="8b424-123">En versiones anteriores de EF, la clase DbProviderServices formaba parte de .NET Framework y se ha encontrado en el espacio de nombres System.Data.Common.</span><span class="sxs-lookup"><span data-stu-id="8b424-123">In older versions of EF the DbProviderServices class was part of the .NET Framework and was found in the System.Data.Common namespace.</span></span> <span data-ttu-id="8b424-124">Comenzando con EF6, esta clase es ahora parte de EntityFramework.dll y en el espacio de nombres System.Data.Entity.Core.Common.</span><span class="sxs-lookup"><span data-stu-id="8b424-124">Starting with EF6 this class is now part of EntityFramework.dll and is in the System.Data.Entity.Core.Common namespace.</span></span>

<span data-ttu-id="8b424-125">Pueden encontrar más detalles sobre la funcionalidad fundamental de una implementación de DbProviderServices en [MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx).</span><span class="sxs-lookup"><span data-stu-id="8b424-125">More details about the fundamental functionality of a DbProviderServices implementation can be found on [MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx).</span></span> <span data-ttu-id="8b424-126">Sin embargo, tenga en cuenta que en el momento de escribir esta información no se actualiza para EF6 aunque la mayoría de los conceptos siguen siendo válida.</span><span class="sxs-lookup"><span data-stu-id="8b424-126">However, note that as of the time of writing this information is not updated for EF6 although most of the concepts are still valid.</span></span> <span data-ttu-id="8b424-127">Las implementaciones de SQL Server y SQL Server Compact de DbProviderServices también se incorporan a la [abierto codebase](https://github.com/aspnet/EntityFramework6/) y puede servir como referencia útil para otras implementaciones.</span><span class="sxs-lookup"><span data-stu-id="8b424-127">The SQL Server and SQL Server Compact implementations of DbProviderServices are also checked into to the [open-source codebase](https://github.com/aspnet/EntityFramework6/) and can serve as useful references for other implementations.</span></span>

<span data-ttu-id="8b424-128">En versiones anteriores de EF se obtuvo la implementación de DbProviderServices para usar directamente desde un proveedor de ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="8b424-128">In older versions of EF the DbProviderServices implementation to use was obtained directly from an ADO.NET provider.</span></span> <span data-ttu-id="8b424-129">Esto se hizo convirtiendo DbProviderFactory a IServiceProvider y llamar al método GetService.</span><span class="sxs-lookup"><span data-stu-id="8b424-129">This was done by casting DbProviderFactory to IServiceProvider and calling the GetService method.</span></span> <span data-ttu-id="8b424-130">Esto estrechamente el proveedor EF a para el objeto DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="8b424-130">This tightly coupled the EF provider to the DbProviderFactory.</span></span> <span data-ttu-id="8b424-131">Este acoplamiento bloqueado EF se desplacen fuera de .NET Framework y, por tanto, para EF6 se quitó este estrecho acoplamiento y ahora está registrada una implementación de DbProviderServices directamente en el archivo de configuración de la aplicación o en basada en código configuración como se describe con más detalle la _registrar DbProviderServices_ sección más adelante.</span><span class="sxs-lookup"><span data-stu-id="8b424-131">This coupling blocked EF from being moved out of the .NET Framework and therefore for EF6 this tight coupling has been removed and an implementation of DbProviderServices is now registered directly in the application’s configuration file or in code-based configuration as described in more detail the _Registering DbProviderServices_ section below.</span></span>

## <a name="additional-services"></a><span data-ttu-id="8b424-132">Servicios adicionales</span><span class="sxs-lookup"><span data-stu-id="8b424-132">Additional services</span></span>

<span data-ttu-id="8b424-133">Además de los servicios fundamentales que se ha descrito anteriormente, hay también muchos otros servicios usados por EF que son específicas del proveedor siempre o a veces.</span><span class="sxs-lookup"><span data-stu-id="8b424-133">In addition to the fundamental services described above there are also many other services used by EF which are either always or sometimes provider-specific.</span></span> <span data-ttu-id="8b424-134">Las implementaciones de específico del proveedor predeterminado de estos servicios pueden proporcionar una implementación de DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="8b424-134">Default provider-specific implementations of these services can be supplied by a DbProviderServices implementation.</span></span> <span data-ttu-id="8b424-135">Las aplicaciones también pueden invalidar las implementaciones de estos servicios, o proporcionar implementaciones cuando un tipo de DbProviderServices no proporciona un valor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="8b424-135">Applications can also override the implementations of these services, or provide implementations when a DbProviderServices type does not provide a default.</span></span> <span data-ttu-id="8b424-136">Esto se describe con más detalle en la _resolver servicios adicionales_ sección más adelante.</span><span class="sxs-lookup"><span data-stu-id="8b424-136">This is described in more detail in the _Resolving additional services_ section below.</span></span>

<span data-ttu-id="8b424-137">Los tipos de servicio adicionales que un proveedor puede ser de interés para un proveedor se enumeran a continuación.</span><span class="sxs-lookup"><span data-stu-id="8b424-137">The additional service types that a provider may be of interest to a provider are listed below.</span></span> <span data-ttu-id="8b424-138">Encontrará más detalles sobre cada uno de estos tipos de servicio en la documentación de API.</span><span class="sxs-lookup"><span data-stu-id="8b424-138">More details about each of these service types can be found in the API documentation.</span></span>

### <a name="idbexecutionstrategy"></a><span data-ttu-id="8b424-139">IDbExecutionStrategy</span><span class="sxs-lookup"><span data-stu-id="8b424-139">IDbExecutionStrategy</span></span>

<span data-ttu-id="8b424-140">Se trata de un servicio opcional que permite a un proveedor implementar reintentos u otro comportamiento cuando se ejecutan las consultas y comandos en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="8b424-140">This is an optional service that allows a provider to implement retries or other behavior when queries and commands are executed against the database.</span></span> <span data-ttu-id="8b424-141">Si no se proporciona ninguna implementación, a continuación, EF simplemente ejecutará los comandos y propagar cualquier excepción producida.</span><span class="sxs-lookup"><span data-stu-id="8b424-141">If no implementation is provided, then EF will simply execute the commands and propagate any exceptions thrown.</span></span> <span data-ttu-id="8b424-142">Este servicio sirve para proporcionar una directiva de reintento que resulta especialmente útil cuando se ejecuta en servidores de base de datos en la nube como SQL Azure para SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8b424-142">For SQL Server this service is used to provide a retry policy which is especially useful when running against cloud-based database servers such as SQL Azure.</span></span>

### <a name="idbconnectionfactory"></a><span data-ttu-id="8b424-143">IDbConnectionFactory</span><span class="sxs-lookup"><span data-stu-id="8b424-143">IDbConnectionFactory</span></span>

<span data-ttu-id="8b424-144">Se trata de un servicio opcional que permite a un proveedor crear objetos de DbConnection por convención, cuando se especifica un nombre de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="8b424-144">This is an optional service that allows a provider to create DbConnection objects by convention when given only a database name.</span></span> <span data-ttu-id="8b424-145">Tenga en cuenta que mientras este servicio se puede resolver por una implementación de DbProviderServices que ha estado presente desde EF 4.1 y puede también establecerse explícitamente en el archivo de configuración o en código.</span><span class="sxs-lookup"><span data-stu-id="8b424-145">Note that while this service can be resolved by a DbProviderServices implementation it has been present since EF 4.1 and can also be explicitly set in either the config file or in code.</span></span> <span data-ttu-id="8b424-146">El proveedor solo obtendrá una oportunidad de resolver este servicio si ha registrado como proveedor predeterminado (consulte _el proveedor predeterminado_ a continuación) y si un generador de conexión predeterminada no se ha establecido en otro lugar.</span><span class="sxs-lookup"><span data-stu-id="8b424-146">The provider will only get a chance to resolve this service if it registered as the default provider (see _The default provider_ below) and if a default connection factory has not been set elsewhere.</span></span>

### <a name="dbspatialservices"></a><span data-ttu-id="8b424-147">DbSpatialServices</span><span class="sxs-lookup"><span data-stu-id="8b424-147">DbSpatialServices</span></span>

<span data-ttu-id="8b424-148">Se trata de un servicio opcional que permite a un proveedor agregar compatibilidad para tipos espaciales geography y geometry.</span><span class="sxs-lookup"><span data-stu-id="8b424-148">This is an optional services that allows a provider to add support for geography and geometry spatial types.</span></span> <span data-ttu-id="8b424-149">Una implementación de este servicio debe proporcionarse en orden para una aplicación para usar EF con tipos espaciales.</span><span class="sxs-lookup"><span data-stu-id="8b424-149">An implementation of this service must be supplied in order for an application to use EF with spatial types.</span></span> <span data-ttu-id="8b424-150">Se le pide DbSptialServices de dos maneras.</span><span class="sxs-lookup"><span data-stu-id="8b424-150">DbSptialServices is asked for in two ways.</span></span> <span data-ttu-id="8b424-151">En primer lugar, específicos del proveedor de servicios espaciales se solicitan con un objeto DbProviderInfo (que contiene todos los idiomas token de manifiesto y nombre) como clave.</span><span class="sxs-lookup"><span data-stu-id="8b424-151">First, provider-specific spatial services are requested using a DbProviderInfo object (which contains invariant name and manifest token) as key.</span></span> <span data-ttu-id="8b424-152">En segundo lugar, se pueden solicitar DbSpatialServices sin la clave.</span><span class="sxs-lookup"><span data-stu-id="8b424-152">Second, DbSpatialServices can be asked for with no key.</span></span> <span data-ttu-id="8b424-153">Esto se utiliza para resolver el "global espacial proveedor" que se usa al crear tipos de DbGeography o DbGeometry independientes.</span><span class="sxs-lookup"><span data-stu-id="8b424-153">This is used to resolve the “global spatial provider” that is used when creating stand-alone DbGeography or DbGeometry types.</span></span>

### <a name="migrationsqlgenerator"></a><span data-ttu-id="8b424-154">MigrationSqlGenerator</span><span class="sxs-lookup"><span data-stu-id="8b424-154">MigrationSqlGenerator</span></span>

<span data-ttu-id="8b424-155">Se trata de un servicio opcional que permite las migraciones de EF que va a usar para la generación de SQL que se usa en la creación y modificación de esquemas de base de datos Code First.</span><span class="sxs-lookup"><span data-stu-id="8b424-155">This is an optional service that allows EF Migrations to be used for the generation of SQL used in creating and modifying database schemas by Code First.</span></span> <span data-ttu-id="8b424-156">Se requiere una implementación con el fin de admitir las migraciones.</span><span class="sxs-lookup"><span data-stu-id="8b424-156">An implementation is required in order to support Migrations.</span></span> <span data-ttu-id="8b424-157">Si no se proporciona una implementación, a continuación, se también se usará cuando se crean las bases de datos con los inicializadores de base de datos o el método Database.Create.</span><span class="sxs-lookup"><span data-stu-id="8b424-157">If an implementation is provided then it will also be used when databases are created using database initializers or the Database.Create method.</span></span>

### <a name="funcdbconnection-string-historycontextfactory"></a><span data-ttu-id="8b424-158">Func < DbConnection, cadena, HistoryContextFactory ></span><span class="sxs-lookup"><span data-stu-id="8b424-158">Func<DbConnection, string, HistoryContextFactory></span></span>

<span data-ttu-id="8b424-159">Se trata de un servicio opcional que permite a un proveedor configurar la asignación de HistoryContext para el `__MigrationHistory` tabla usada por migraciones de EF.</span><span class="sxs-lookup"><span data-stu-id="8b424-159">This is an optional service that allows a provider to configure the mapping of the HistoryContext to the `__MigrationHistory` table used by EF Migrations.</span></span> <span data-ttu-id="8b424-160">HistoryContext es un primer DbContext de código y se puede configurar mediante la API fluida normal para cambiar cosas como el nombre de la tabla y las especificaciones de asignación de columna.</span><span class="sxs-lookup"><span data-stu-id="8b424-160">The HistoryContext is a Code First DbContext and can be configured using the normal fluent API to change things like the name of the table and the column mapping specifications.</span></span> <span data-ttu-id="8b424-161">La implementación predeterminada de este servicio devuelto por EF para todos los proveedores puede funcionar para un servidor de base de datos determinada si todas las tablas y columnas asignaciones predeterminadas son compatibles con ese proveedor.</span><span class="sxs-lookup"><span data-stu-id="8b424-161">The default implementation of this service returned by EF for all providers may work for a given database server if all the default table and column mappings are supported by that provider.</span></span> <span data-ttu-id="8b424-162">En este caso el proveedor no es necesario proporcionar una implementación de este servicio.</span><span class="sxs-lookup"><span data-stu-id="8b424-162">In such a case the provider does not need to supply an implementation of this service.</span></span>

### <a name="idbproviderfactoryresolver"></a><span data-ttu-id="8b424-163">IDbProviderFactoryResolver</span><span class="sxs-lookup"><span data-stu-id="8b424-163">IDbProviderFactoryResolver</span></span>

<span data-ttu-id="8b424-164">Se trata de un servicio opcional para obtener DbProviderFactory correcto de un determinado objeto DbConnection.</span><span class="sxs-lookup"><span data-stu-id="8b424-164">This is an optional service for obtaining the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="8b424-165">La implementación predeterminada de este servicio devuelto por EF para todos los proveedores está diseñada para funcionar en todos los proveedores.</span><span class="sxs-lookup"><span data-stu-id="8b424-165">The default implementation of this service returned by EF for all providers is intended to work for all providers.</span></span> <span data-ttu-id="8b424-166">Sin embargo, cuando se ejecuta en .NET 4, el objeto DbProviderFactory no es accesible públicamente desde uno si su DbConnections.</span><span class="sxs-lookup"><span data-stu-id="8b424-166">However, when running on .NET 4, the DbProviderFactory is not publicly accessible from one if its DbConnections.</span></span> <span data-ttu-id="8b424-167">Por lo tanto, EF usa parte de la heurística para buscar los proveedores registrados para encontrar a una coincidencia.</span><span class="sxs-lookup"><span data-stu-id="8b424-167">Therefore, EF uses some heuristics to search the registered providers to find a match.</span></span> <span data-ttu-id="8b424-168">Es posible que algunos proveedores de estas heurísticas se producirá un error y en dichas situaciones, el proveedor debería proporcionar una nueva implementación.</span><span class="sxs-lookup"><span data-stu-id="8b424-168">It is possible that for some providers these heuristics will fail and in such situations the provider should supply a new implementation.</span></span>

## <a name="registering-dbproviderservices"></a><span data-ttu-id="8b424-169">Registrar DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="8b424-169">Registering DbProviderServices</span></span>

<span data-ttu-id="8b424-170">La implementación de DbProviderServices para usar se puede registrar en el archivo de configuración (app.config o web.config) o mediante configuración basada en código de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8b424-170">The DbProviderServices implementation to use can be registered either in the application’s configuration file (app.config or web.config) or using code-based configuration.</span></span> <span data-ttu-id="8b424-171">En ambos casos el registro usa el nombre del proveedor"invariable" como clave.</span><span class="sxs-lookup"><span data-stu-id="8b424-171">In either case the registration uses the provider’s “invariant name” as a key.</span></span> <span data-ttu-id="8b424-172">Esto permite que varios proveedores registrar y utilizar en una sola aplicación.</span><span class="sxs-lookup"><span data-stu-id="8b424-172">This allows multiple providers to be registered and used in a single application.</span></span> <span data-ttu-id="8b424-173">El nombre invariable usado para los registros EF es el mismo que el nombre invariable usado para cadenas de conexión y registro del proveedor ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="8b424-173">The invariant name used for EF registrations is the same as the invariant name used for ADO.NET provider registration and connection strings.</span></span> <span data-ttu-id="8b424-174">Por ejemplo, se usa "System.Data.SqlClient" para el nombre invariable de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8b424-174">For example, for SQL Server the invariant name “System.Data.SqlClient” is used.</span></span>

### <a name="config-file-registration"></a><span data-ttu-id="8b424-175">Registro en el archivo de configuración</span><span class="sxs-lookup"><span data-stu-id="8b424-175">Config file registration</span></span>

<span data-ttu-id="8b424-176">El tipo de DbProviderServices para utilizar se registra como un elemento de proveedor en la lista de proveedores de la sección entityFramework del archivo de configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8b424-176">The DbProviderServices type to use is registered as a provider element in the providers list of the entityFramework section of the application’s config file.</span></span> <span data-ttu-id="8b424-177">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="8b424-177">For example:</span></span>

``` xml
<entityFramework>
  <providers>
    <provider invariantName="My.Invariant.Name" type="MyProvider.MyProviderServices, MyAssembly" />
  </providers>
</entityFramework>
```

<span data-ttu-id="8b424-178">El _tipo_ cadena debe ser el nombre de tipo calificado con el ensamblado de la implementación de DbProviderServices a utilizar.</span><span class="sxs-lookup"><span data-stu-id="8b424-178">The _type_ string must be the assembly-qualified type name of the DbProviderServices implementation to use.</span></span>

### <a name="code-based-registration"></a><span data-ttu-id="8b424-179">Registro basado en código</span><span class="sxs-lookup"><span data-stu-id="8b424-179">Code-based registration</span></span>

<span data-ttu-id="8b424-180">A partir de los proveedores de EF6 también se puede registrar mediante código.</span><span class="sxs-lookup"><span data-stu-id="8b424-180">Starting with EF6 providers can also be registered using code.</span></span> <span data-ttu-id="8b424-181">Esto permite que un proveedor EF para usarse sin realizar ningún cambio al archivo de configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8b424-181">This allows an EF provider to be used without any change to the application’s configuration file.</span></span> <span data-ttu-id="8b424-182">Para usar la configuración basada en el código de una aplicación debe crear una clase DbConfiguration como se describe en el [documentación sobre la configuración basada en código](http://msdn.com/data/jj680699).</span><span class="sxs-lookup"><span data-stu-id="8b424-182">To use code-based configuration an application should create a DbConfiguration class as described in the [code-based configuration documentation](http://msdn.com/data/jj680699).</span></span> <span data-ttu-id="8b424-183">El constructor de la clase DbConfiguration, a continuación, debe llamar a SetProviderServices para registrar el proveedor EF.</span><span class="sxs-lookup"><span data-stu-id="8b424-183">The constructor of the DbConfiguration class should then call SetProviderServices to register the EF provider.</span></span> <span data-ttu-id="8b424-184">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="8b424-184">For example:</span></span>

``` csharp
public class MyConfiguration : DbConfiguration
{
    public MyConfiguration()
    {
        SetProviderServices("My.New.Provider", new MyProviderServices());
    }
}
```

## <a name="resolving-additional-services"></a><span data-ttu-id="8b424-185">Resolver los servicios adicionales</span><span class="sxs-lookup"><span data-stu-id="8b424-185">Resolving additional services</span></span>

<span data-ttu-id="8b424-186">Como se mencionó anteriormente en el _información general sobre los tipos de proveedor_ sección un DbProviderServices clase puede usarse también para resolver los servicios adicionales.</span><span class="sxs-lookup"><span data-stu-id="8b424-186">As mentioned above in the _Provider types overview_ section, a DbProviderServices class can also be used to resolve additional services.</span></span> <span data-ttu-id="8b424-187">Esto es posible porque DbProviderServices implementa IDbDependencyResolver y cada tipo de DbProviderServices registrado se agrega como una resolución"predeterminada".</span><span class="sxs-lookup"><span data-stu-id="8b424-187">This is possible because DbProviderServices implements IDbDependencyResolver and each registered DbProviderServices type is added as a “default resolver”.</span></span> <span data-ttu-id="8b424-188">El mecanismo de IDbDpendencyResolver se describe con más detalle en [resolución de dependencia](~/ef6/fundamentals/configuring/dependency-resolution.md).</span><span class="sxs-lookup"><span data-stu-id="8b424-188">The IDbDpendencyResolver mechanism is described in more detail in [Dependency Resolution](~/ef6/fundamentals/configuring/dependency-resolution.md).</span></span> <span data-ttu-id="8b424-189">Sin embargo, no es necesario comprender todos los conceptos en esta especificación para resolver los servicios adicionales en un proveedor.</span><span class="sxs-lookup"><span data-stu-id="8b424-189">However, it is not necessary to understand all the concepts in this specification to resolve additional services in a provider.</span></span>

<span data-ttu-id="8b424-190">La manera más común para un proveedor resolver los servicios adicionales es llamar a DbProviderServices.AddDependencyResolver para cada servicio en el constructor de la clase DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="8b424-190">The most common way for a provider to resolve additional services is to call DbProviderServices.AddDependencyResolver for each service in the constructor of the DbProviderServices class.</span></span> <span data-ttu-id="8b424-191">Por ejemplo, SqlProviderServices (el proveedor EF para SQL Server) tiene código similar al siguiente para la inicialización:</span><span class="sxs-lookup"><span data-stu-id="8b424-191">For example, SqlProviderServices (the EF provider for SQL Server) has code similar to this for initialization:</span></span>

``` csharp
private SqlProviderServices()
{
    AddDependencyResolver(new SingletonDependencyResolver<IDbConnectionFactory>(
        new SqlConnectionFactory()));

    AddDependencyResolver(new ExecutionStrategyResolver<DefaultSqlExecutionStrategy>(
        "System.data.SqlClient", null, () => new DefaultSqlExecutionStrategy()));

    AddDependencyResolver(new SingletonDependencyResolver<Func<MigrationSqlGenerator>>(
        () => new SqlServerMigrationSqlGenerator(), "System.data.SqlClient"));

    AddDependencyResolver(new SingletonDependencyResolver<DbSpatialServices>(
        SqlSpatialServices.Instance,
        k =>
        {
            var asSpatialKey = k as DbProviderInfo;
            return asSpatialKey == null
                || asSpatialKey.ProviderInvariantName == ProviderInvariantName;
        }));
}
```

<span data-ttu-id="8b424-192">Este constructor utiliza las clases de auxiliares siguientes:</span><span class="sxs-lookup"><span data-stu-id="8b424-192">This constructor uses the following helper classes:</span></span>

*   <span data-ttu-id="8b424-193">SingletonDependencyResolver: proporciona una manera sencilla para resolver los servicios de Singleton, es decir, los servicios para que la misma instancia se devuelve cada vez que se llama a GetService.</span><span class="sxs-lookup"><span data-stu-id="8b424-193">SingletonDependencyResolver: provides a simple way to resolve Singleton services—that is, services for which the same instance is returned each time that GetService is called.</span></span> <span data-ttu-id="8b424-194">Los servicios transitorios a menudo se registran como una fábrica de singleton que se usará para crear instancias transitorias bajo demanda.</span><span class="sxs-lookup"><span data-stu-id="8b424-194">Transient services are often registered as a singleton factory that will be used to create transient instances on demand.</span></span>
*   <span data-ttu-id="8b424-195">ExecutionStrategyResolver: una resolución específica para devolver IExecutionStrategy implementaciones.</span><span class="sxs-lookup"><span data-stu-id="8b424-195">ExecutionStrategyResolver: a resolver specific to returning IExecutionStrategy implementations.</span></span>

<span data-ttu-id="8b424-196">En lugar de usar DbProviderServices.AddDependencyResolver también es posible invalidar DbProviderServices.GetService y resolver los servicios adicionales directamente.</span><span class="sxs-lookup"><span data-stu-id="8b424-196">Instead of using DbProviderServices.AddDependencyResolver it is also possible to override DbProviderServices.GetService and resolve additional services directly.</span></span> <span data-ttu-id="8b424-197">Este método se llamará cuando EF necesita un servicio definido por un tipo determinado y, en algunos casos, para una clave determinada.</span><span class="sxs-lookup"><span data-stu-id="8b424-197">This method will be called when EF needs a service defined by a certain type and, in some cases, for a given key.</span></span> <span data-ttu-id="8b424-198">El método debe devolver el servicio si puede, o devuelve null para participar de devolver el servicio y permita que la otra clase resolverlo.</span><span class="sxs-lookup"><span data-stu-id="8b424-198">The method should return the service if it can, or return null to opt-out of returning the service and instead allow another class to resolve it.</span></span> <span data-ttu-id="8b424-199">Por ejemplo, para resolver el generador de conexiones de forma predeterminada el código en GetService sería algo parecido a esto:</span><span class="sxs-lookup"><span data-stu-id="8b424-199">For example, to resolve the default connection factory the code in GetService might look something like this:</span></span>

``` csharp
public override object GetService(Type type, object key)
{
    if (type == typeof(IDbConnectionFactory))
    {
        return new SqlConnectionFactory();
    }
    return null;
}
```

### <a name="registration-order"></a><span data-ttu-id="8b424-200">Orden de registro</span><span class="sxs-lookup"><span data-stu-id="8b424-200">Registration order</span></span>

<span data-ttu-id="8b424-201">Cuando varias implementaciones de DbProviderServices se registran en el archivo de configuración de la aplicación se agregará como solucionadores secundaria en el orden en que aparecen.</span><span class="sxs-lookup"><span data-stu-id="8b424-201">When multiple DbProviderServices implementations are registered in an application’s config file they will be added as secondary resolvers in the order that they are listed.</span></span> <span data-ttu-id="8b424-202">Puesto que las resoluciones siempre se agregan a la parte superior de la cadena de resolución secundaria que esto significa que el proveedor al final de la lista tendrá la posibilidad para resolver las dependencias antes de los demás.</span><span class="sxs-lookup"><span data-stu-id="8b424-202">Since resolvers are always added to the top of the secondary resolver chain this means that the provider at the end of the list will get a chance to resolve dependencies before the others.</span></span> <span data-ttu-id="8b424-203">(Esto puede parecer un poco contradictorio al principio, pero tiene sentido si imagine teniendo cada proveedor de la lista y apilamiento encima de los proveedores existentes).</span><span class="sxs-lookup"><span data-stu-id="8b424-203">(This can seem a little counter-intuitive at first, but it makes sense if you imagine taking each provider out of the list and stacking it on top of the existing providers.)</span></span>

<span data-ttu-id="8b424-204">Esta ordenación normalmente no tiene importancia ya que la mayoría de los servicios de proveedor son específicos del proveedor y con clave por el nombre invariable del proveedor.</span><span class="sxs-lookup"><span data-stu-id="8b424-204">This ordering usually doesn’t matter because most provider services are provider-specific and keyed by provider invariant name.</span></span> <span data-ttu-id="8b424-205">Sin embargo, para los servicios que no están organizados por nombre invariable del proveedor o algunos otro específica del proveedor clave que se resolverá el servicio basado en este orden.</span><span class="sxs-lookup"><span data-stu-id="8b424-205">However, for services that are not keyed by provider invariant name or some other provider-specific key the service will be resolved based on this ordering.</span></span> <span data-ttu-id="8b424-206">Por ejemplo, si no se establece explícitamente forma distinta en otro caso contrario, el generador de conexión predeterminado procederán del proveedor de nivel superior en la cadena.</span><span class="sxs-lookup"><span data-stu-id="8b424-206">For example, if it is not explicitly set differently somewhere else, then the default connection factory will come from the topmost provider in the chain.</span></span>

## <a name="additional-config-file-registrations"></a><span data-ttu-id="8b424-207">Registros de archivo de configuración adicionales</span><span class="sxs-lookup"><span data-stu-id="8b424-207">Additional config file registrations</span></span>

<span data-ttu-id="8b424-208">Es posible registrar de forma explícita algunos de los servicios adicionales del proveedor que se ha descrito anteriormente directamente en el archivo de configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8b424-208">It is possible to explicitly register some of the additional provider services described above directly in an application’s config file.</span></span> <span data-ttu-id="8b424-209">Cuando esto se realiza el registro en el archivo de configuración se usará en lugar de nada devuelto por el método GetService de la implementación de DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="8b424-209">When this is done the registration in the config file will be used instead of anything returned by the GetService method of the DbProviderServices implementation.</span></span>

### <a name="registering-the-default-connection-factory"></a><span data-ttu-id="8b424-210">Registrar el generador de conexión predeterminado</span><span class="sxs-lookup"><span data-stu-id="8b424-210">Registering the default connection factory</span></span>

<span data-ttu-id="8b424-211">Iniciar con EF5 el paquete EntityFramework NuGet automáticamente registra el generador de conexiones SQL Express o el generador de conexión LocalDb en el archivo de configuración.</span><span class="sxs-lookup"><span data-stu-id="8b424-211">Starting with EF5 the EntityFramework NuGet package automatically registered either the SQL Express connection factory or the LocalDb connection factory in the config file.</span></span>

<span data-ttu-id="8b424-212">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="8b424-212">For example:</span></span>

``` xml
<entityFramework>
  <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" >
</entityFramework>
```

<span data-ttu-id="8b424-213">El _tipo_ es el nombre de tipo calificado con el ensamblado para el generador de conexión predeterminado, que debe implementar IDbConnectionFactory.</span><span class="sxs-lookup"><span data-stu-id="8b424-213">The _type_ is the assembly-qualified type name for the default connection factory, which must implement IDbConnectionFactory.</span></span>

<span data-ttu-id="8b424-214">Se recomienda que un paquete de NuGet del proveedor establecida el generador de conexión predeterminado de esta manera, cuando está instalado.</span><span class="sxs-lookup"><span data-stu-id="8b424-214">It is recommended that a provider NuGet package set the default connection factory in this way when installed.</span></span> <span data-ttu-id="8b424-215">Consulte _paquetes de NuGet para proveedores_ a continuación.</span><span class="sxs-lookup"><span data-stu-id="8b424-215">See _NuGet Packages for providers_ below.</span></span>

## <a name="additional-ef6-provider-changes"></a><span data-ttu-id="8b424-216">Cambios adicionales de proveedor de EF6</span><span class="sxs-lookup"><span data-stu-id="8b424-216">Additional EF6 provider changes</span></span>

### <a name="spatial-provider-changes"></a><span data-ttu-id="8b424-217">Cambios de proveedor espacial</span><span class="sxs-lookup"><span data-stu-id="8b424-217">Spatial provider changes</span></span>

<span data-ttu-id="8b424-218">Los proveedores que admiten tipos espaciales ahora deben implementar algunos métodos adicionales en clases derivadas de DbSpatialDataReader:</span><span class="sxs-lookup"><span data-stu-id="8b424-218">Providers that support spatial types must now implement some additional methods on classes deriving from DbSpatialDataReader:</span></span>

*   `public abstract bool IsGeographyColumn(int ordinal)`
*   `public abstract bool IsGeometryColumn(int ordinal)`

<span data-ttu-id="8b424-219">También hay nuevas versiones asincrónicas de los métodos existentes que se recomiendan para invalidarse según las implementaciones predeterminadas delegan a los métodos sincrónicos y, por tanto, no se ejecutan asincrónicamente:</span><span class="sxs-lookup"><span data-stu-id="8b424-219">There are also new asynchronous versions of existing methods that are recommended to be overridden as the default implementations delegate to the synchronous methods and therefore do not execute asynchronously:</span></span>

*   `public virtual Task<DbGeography> GetGeographyAsync(int ordinal, CancellationToken cancellationToken)`
*   `public virtual Task<DbGeometry> GetGeometryAsync(int ordinal, CancellationToken cancellationToken)`

### <a name="native-support-for-enumerablecontains"></a><span data-ttu-id="8b424-220">Compatibilidad nativa para Enumerable.Contains</span><span class="sxs-lookup"><span data-stu-id="8b424-220">Native support for Enumerable.Contains</span></span>

<span data-ttu-id="8b424-221">EF6 presenta a un nuevo tipo de expresión, DbInExpression, que se agregó para solucionar problemas de rendimiento en torno a uso de Enumerable.Contains en consultas LINQ.</span><span class="sxs-lookup"><span data-stu-id="8b424-221">EF6 introduces a new expression type, DbInExpression, which was added to address performance issues around use of Enumerable.Contains in LINQ queries.</span></span> <span data-ttu-id="8b424-222">La clase DbProviderManifest tiene un nuevo método virtual SupportsInExpression, que es invocado por EF para determinar si un proveedor controla el nuevo tipo de expresión.</span><span class="sxs-lookup"><span data-stu-id="8b424-222">The DbProviderManifest class has a new virtual method, SupportsInExpression, which is called by EF to determine if a provider handles the new expression type.</span></span> <span data-ttu-id="8b424-223">Para ofrecer compatibilidad con las implementaciones existentes del proveedor, el método devuelve false.</span><span class="sxs-lookup"><span data-stu-id="8b424-223">For compatibility with existing provider implementations the method returns false.</span></span> <span data-ttu-id="8b424-224">Para aprovechar esta mejora, un proveedor de EF6 puede agregar código para controlar DbInExpression e invalidar SupportsInExpression devuelva true.</span><span class="sxs-lookup"><span data-stu-id="8b424-224">To benefit from this improvement, an EF6 provider can add code to handle DbInExpression and override SupportsInExpression to return true.</span></span> <span data-ttu-id="8b424-225">Puede crearse una instancia de DbInExpression llamando al método DbExpressionBuilder.In.</span><span class="sxs-lookup"><span data-stu-id="8b424-225">An instance of DbInExpression can be created by calling the DbExpressionBuilder.In method.</span></span> <span data-ttu-id="8b424-226">Una instancia de DbInExpression se compone de un DbExpression, que normalmente representa una columna de tabla y una lista de DbConstantExpression para buscar una coincidencia.</span><span class="sxs-lookup"><span data-stu-id="8b424-226">A DbInExpression instance is composed of a DbExpression, usually representing a table column, and a list of DbConstantExpression to test for a match.</span></span>

## <a name="nuget-packages-for-providers"></a><span data-ttu-id="8b424-227">Paquetes de NuGet para proveedores</span><span class="sxs-lookup"><span data-stu-id="8b424-227">NuGet packages for providers</span></span>

<span data-ttu-id="8b424-228">Una manera para que esté disponible un proveedor de EF6 es lo libera como un paquete de NuGet.</span><span class="sxs-lookup"><span data-stu-id="8b424-228">One way to make an EF6 provider available is to release it as a NuGet package.</span></span> <span data-ttu-id="8b424-229">Uso de un paquete de NuGet tiene las siguientes ventajas:</span><span class="sxs-lookup"><span data-stu-id="8b424-229">Using a NuGet package has the following advantages:</span></span>

*   <span data-ttu-id="8b424-230">Es fácil de usar NuGet para agregar el registro del proveedor al archivo de configuración de la aplicación</span><span class="sxs-lookup"><span data-stu-id="8b424-230">It is easy to use NuGet to add the provider registration to the application’s config file</span></span>
*   <span data-ttu-id="8b424-231">Pueden realizarse cambios adicionales al archivo de configuración para establecer el generador de conexiones predeterminado para que las conexiones realizadas por convención, use el proveedor registrado</span><span class="sxs-lookup"><span data-stu-id="8b424-231">Additional changes can be made to the config file to set the default connection factory so that connections made by convention will use the registered provider</span></span>
*   <span data-ttu-id="8b424-232">NuGet controla agregar redirecciones de enlace para que el proveedor de EF6 debe continuar funcionando incluso después de que se publica un nuevo paquete EF</span><span class="sxs-lookup"><span data-stu-id="8b424-232">NuGet handles adding binding redirects so that the EF6 provider should continue to work even after a new EF package is released</span></span>

<span data-ttu-id="8b424-233">Un ejemplo de esto es el paquete de EntityFramework.SqlServerCompact que se incluye en el [abierto codebase](http://github.com/aspnet/entityframework6).</span><span class="sxs-lookup"><span data-stu-id="8b424-233">An example of this is the EntityFramework.SqlServerCompact package which is included in the [open source codebase](http://github.com/aspnet/entityframework6).</span></span> <span data-ttu-id="8b424-234">Este paquete proporciona una buena plantilla para crear el proveedor EF paquetes de NuGet.</span><span class="sxs-lookup"><span data-stu-id="8b424-234">This package provides a good template for creating EF provider NuGet packages.</span></span>

### <a name="powershell-commands"></a><span data-ttu-id="8b424-235">Comandos de PowerShell</span><span class="sxs-lookup"><span data-stu-id="8b424-235">PowerShell commands</span></span>

<span data-ttu-id="8b424-236">Cuando se instala el paquete EntityFramework NuGet registra un módulo de PowerShell que contiene dos comandos que son muy útiles para los paquetes de proveedor:</span><span class="sxs-lookup"><span data-stu-id="8b424-236">When the EntityFramework NuGet package is installed it registers a PowerShell module that contains two commands that are very useful for provider packages:</span></span>

*   <span data-ttu-id="8b424-237">EFProvider agregar agrega una nueva entidad para el proveedor en el archivo de configuración del proyecto de destino y se asegura de que está al final de la lista de los proveedores registrados.</span><span class="sxs-lookup"><span data-stu-id="8b424-237">Add-EFProvider adds a new entity for the provider in the target project’s configuration file and makes sure it is at the end of the list of registered providers.</span></span>
*   <span data-ttu-id="8b424-238">EFDefaultConnectionFactory agregar agrega o actualiza el registro defaultConnectionFactory en el archivo de configuración del proyecto de destino.</span><span class="sxs-lookup"><span data-stu-id="8b424-238">Add-EFDefaultConnectionFactory either adds or updates the defaultConnectionFactory registration in the target project’s configuration file.</span></span>

<span data-ttu-id="8b424-239">Estos dos comandos se encargan de agregar una sección entityFramework al archivo de configuración y agregar una colección de proveedores, si es necesario.</span><span class="sxs-lookup"><span data-stu-id="8b424-239">Both these commands take care of adding an entityFramework section to the config file and adding a providers collection if necessary.</span></span>

<span data-ttu-id="8b424-240">Su objetivo es que estos comandos se llama desde la secuencia de comandos de NuGet install.ps1.</span><span class="sxs-lookup"><span data-stu-id="8b424-240">It is intended that these commands be called from the install.ps1 NuGet script.</span></span> <span data-ttu-id="8b424-241">Por ejemplo, install.ps1 para el proveedor de SQL Compact es similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="8b424-241">For example, install.ps1 for the SQL Compact provider looks similar to this:</span></span>

``` powershell
param($installPath, $toolsPath, $package, $project)
Add-EFDefaultConnectionFactory $project 'System.Data.Entity.Infrastructure.SqlCeConnectionFactory, EntityFramework' -ConstructorArguments 'System.Data.SqlServerCe.4.0'
Add-EFProvider $project 'System.Data.SqlServerCe.4.0' 'System.Data.Entity.SqlServerCompact.SqlCeProviderServices, EntityFramework.SqlServerCompact'</pre>
```

<span data-ttu-id="8b424-242">Para obtener más información acerca de estos comandos se puede obtener mediante el uso de get-help en la ventana de consola de administrador de paquetes.</span><span class="sxs-lookup"><span data-stu-id="8b424-242">More information about these commands can be obtained by using get-help in the Package Manager Console window.</span></span>

## <a name="wrapping-providers"></a><span data-ttu-id="8b424-243">Proveedores de ajuste</span><span class="sxs-lookup"><span data-stu-id="8b424-243">Wrapping providers</span></span>

<span data-ttu-id="8b424-244">Un proveedor de ajuste es un proveedor EF o ADO.NET que contiene un proveedor existente para ampliarlo con otras funcionalidades, como la generación de perfiles o capacidades de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="8b424-244">A wrapping provider is an EF and/or ADO.NET provider that wraps an existing provider to extend it with other functionality such as profiling or tracing capabilities.</span></span> <span data-ttu-id="8b424-245">Se puede registrar proveedores de ajuste de la manera normal, pero a menudo resulta más conveniente configurar el proveedor de ajuste en tiempo de ejecución mediante la interceptación de la resolución de los servicios relacionados con el proveedor.</span><span class="sxs-lookup"><span data-stu-id="8b424-245">Wrapping providers can be registered in the normal way, but it is often more convenient to setup the wrapping provider at runtime by intercepting the resolution of provider-related services.</span></span> <span data-ttu-id="8b424-246">El evento estático OnLockingConfiguration en la clase DbConfiguration puede usarse para hacer esto.</span><span class="sxs-lookup"><span data-stu-id="8b424-246">The static event OnLockingConfiguration on the DbConfiguration class can be used to do this.</span></span>

<span data-ttu-id="8b424-247">OnLockingConfiguration se llama después de EF ha determinado que se obtendrán de toda la configuración de EF para el dominio de aplicación, pero antes de que se bloquee para su uso.</span><span class="sxs-lookup"><span data-stu-id="8b424-247">OnLockingConfiguration is called after EF has determined where all EF configuration for the app domain will be obtained from but before it is locked for use.</span></span> <span data-ttu-id="8b424-248">Al iniciar la aplicación (antes de que se usa EF) la aplicación debe registrar un controlador de eventos para este evento.</span><span class="sxs-lookup"><span data-stu-id="8b424-248">At app startup (before EF is used) the app should register an event handler for this event.</span></span> <span data-ttu-id="8b424-249">(Estamos considerando agregar compatibilidad para registrar este controlador en el archivo de configuración, pero esto no se admite todavía). El controlador de eventos, a continuación, debe realizar una llamada a ReplaceService para todos los servicios que deben ajustarse.</span><span class="sxs-lookup"><span data-stu-id="8b424-249">(We are considering adding support for registering this handler in the config file but this is not yet supported.) The event handler should then make a call to ReplaceService for every service that needs to be wrapped.</span></span>  

<span data-ttu-id="8b424-250">Por ejemplo, para encapsular IDbConnectionFactory y DbProviderService, se debe registrar un controlador algo parecido a esto:</span><span class="sxs-lookup"><span data-stu-id="8b424-250">For example, to wrap IDbConnectionFactory and DbProviderService, a handler something like this should be registered:</span></span>

``` csharp
DbConfiguration.OnLockingConfiguration +=
    (_, a) =>
    {
        a.ReplaceService<DbProviderServices>(
            (s, k) => new MyWrappedProviderServices(s));

        a.ReplaceService<IDbConnectionFactory>(
            (s, k) => new MyWrappedConnectionFactory(s));
    };
```

<span data-ttu-id="8b424-251">El servicio que se ha resuelto y debe ajustarse junto con la clave que se usó para resolver el servicio se pasan al controlador.</span><span class="sxs-lookup"><span data-stu-id="8b424-251">The service that has been resolved and should now be wrapped together with the key that was used to resolve the service are passed to the handler.</span></span> <span data-ttu-id="8b424-252">El controlador, a continuación, puede ajustar este servicio y reemplace el servicio devuelto por la versión ajustada.</span><span class="sxs-lookup"><span data-stu-id="8b424-252">The handler can then wrap this service and replace the returned service with the wrapped version.</span></span>

## <a name="resolving-a-dbproviderfactory-with-ef"></a><span data-ttu-id="8b424-253">Resolución de un objeto DbProviderFactory con EF.</span><span class="sxs-lookup"><span data-stu-id="8b424-253">Resolving a DbProviderFactory with EF</span></span>

<span data-ttu-id="8b424-254">DbProviderFactory es uno de los tipos de proveedor fundamentales necesarios para EF, como se describe en el _información general sobre los tipos de proveedor_ sección anterior.</span><span class="sxs-lookup"><span data-stu-id="8b424-254">DbProviderFactory is one of the fundamental provider types needed by EF as described in the _Provider types overview_ section above.</span></span> <span data-ttu-id="8b424-255">Como ya se ha mencionado, no es un tipo de EF y registro no suele ser parte de la configuración de EF, pero en su lugar es el registro del proveedor ADO.NET normal en el archivo machine.config o el archivo de configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8b424-255">As already mentioned, It is not an EF type and registration is usually not part of EF configuration, but is instead the normal ADO.NET provider registration in the machine.config file and/or application’s config file.</span></span>

<span data-ttu-id="8b424-256">A pesar de esta EF sigue usando su mecanismo de resolución de dependencia normal cuando se busca un objeto DbProviderFactory para usar.</span><span class="sxs-lookup"><span data-stu-id="8b424-256">Despite this EF still uses its normal dependency resolution mechanism when looking for a DbProviderFactory to use.</span></span> <span data-ttu-id="8b424-257">El solucionador predeterminado usa el registro ADO.NET normal en los archivos de configuración y aquí es suele ser transparente.</span><span class="sxs-lookup"><span data-stu-id="8b424-257">The default resolver uses the normal ADO.NET registration in the config files and so this is usually transparent.</span></span> <span data-ttu-id="8b424-258">Pero debido a la resolución de dependencia normal se usa el mecanismo significa que se puede usar un IDbDependencyResolver para resolver un objeto DbProviderFactory incluso cuando no se ha realizado el registro ADO.NET normal.</span><span class="sxs-lookup"><span data-stu-id="8b424-258">But because of the normal dependency resolution mechanism is used it means that an IDbDependencyResolver can be used to resolve a DbProviderFactory even when normal ADO.NET registration has not been done.</span></span>

<span data-ttu-id="8b424-259">Resolver DbProviderFactory de este modo tiene varias implicaciones:</span><span class="sxs-lookup"><span data-stu-id="8b424-259">Resolving DbProviderFactory in this way has several implications:</span></span>

*   <span data-ttu-id="8b424-260">Una aplicación mediante la configuración basada en el código puede agregar llamadas en su clase DbConfiguration para registrar el objeto DbProviderFactory adecuado.</span><span class="sxs-lookup"><span data-stu-id="8b424-260">An application using code-based configuration can add calls in their DbConfiguration class to register the appropriate DbProviderFactory.</span></span> <span data-ttu-id="8b424-261">Esto es especialmente útil para las aplicaciones que no desean (o no) hacer uso de cualquier configuración basada en archivo en absoluto.</span><span class="sxs-lookup"><span data-stu-id="8b424-261">This is especially useful for applications that do not want to (or cannot) make use of any file-based configuration at all.</span></span>
*   <span data-ttu-id="8b424-262">El servicio se puede ajustar o reemplazar utilizando ReplaceService como se describe en el _ajuste proveedores_ sección anterior</span><span class="sxs-lookup"><span data-stu-id="8b424-262">The service can be wrapped or replaced using ReplaceService as described in the _Wrapping providers_ section above</span></span>
*   <span data-ttu-id="8b424-263">En teoría, una implementación de DbProviderServices pudo resolver un objeto DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="8b424-263">Theoretically, a DbProviderServices implementation could resolve a DbProviderFactory.</span></span>

<span data-ttu-id="8b424-264">El punto importante a tener en cuenta acerca de cómo realizar cualquiera de estas acciones es que sólo afectarán a la búsqueda de DbProviderFactory EF.</span><span class="sxs-lookup"><span data-stu-id="8b424-264">The important point to note about doing any of these things is that they will only affect the lookup of DbProviderFactory by EF.</span></span> <span data-ttu-id="8b424-265">Otro código de EF no puede seguir esperando que el proveedor de ADO.NET que estar registrado en la forma habitual y puede producir un error si no se encuentra el registro.</span><span class="sxs-lookup"><span data-stu-id="8b424-265">Other non-EF code may still expect the ADO.NET provider to be registered in the normal way and may fail if the registration is not found.</span></span> <span data-ttu-id="8b424-266">Por este motivo es normalmente más adecuado para un objeto DbProviderFactory para registrarse en la forma habitual de ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="8b424-266">For this reason it is normally better for a DbProviderFactory to be registered in the normal ADO.NET way.</span></span>

### <a name="related-services"></a><span data-ttu-id="8b424-267">Servicios relacionados</span><span class="sxs-lookup"><span data-stu-id="8b424-267">Related services</span></span>

<span data-ttu-id="8b424-268">Si EF se usa para resolver un objeto DbProviderFactory, a continuación, también debe resolver los servicios IProviderInvariantName y IDbProviderFactoryResolver.</span><span class="sxs-lookup"><span data-stu-id="8b424-268">If EF is used to resolve a DbProviderFactory, then it should also resolve the IProviderInvariantName and IDbProviderFactoryResolver services.</span></span>

<span data-ttu-id="8b424-269">IProviderInvariantName es un servicio que se usa para determinar un nombre invariable del proveedor para un tipo determinado de DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="8b424-269">IProviderInvariantName is a service that is used to determine a provider invariant name for a given type of DbProviderFactory.</span></span> <span data-ttu-id="8b424-270">La implementación predeterminada de este servicio utiliza el registro del proveedor ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="8b424-270">The default implementation of this service uses the ADO.NET provider registration.</span></span> <span data-ttu-id="8b424-271">Esto significa que si no está registrado el proveedor de ADO.NET de la manera normal porque se está resolviendo DbProviderFactory con EF, a continuación, también será necesario resolver este servicio.</span><span class="sxs-lookup"><span data-stu-id="8b424-271">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span> <span data-ttu-id="8b424-272">Tenga en cuenta que una resolución para este servicio se agrega automáticamente al usar el método DbConfiguration.SetProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="8b424-272">Note that a resolver for this service is automatically added when using the DbConfiguration.SetProviderFactory method.</span></span>

<span data-ttu-id="8b424-273">Como se describe en el _información general sobre los tipos de proveedor_ sección anterior, se usa el IDbProviderFactoryResolver obtener DbProviderFactory correcto de un determinado objeto DbConnection.</span><span class="sxs-lookup"><span data-stu-id="8b424-273">As described in the _Provider types overview_ section above, the IDbProviderFactoryResolver is used to obtain the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="8b424-274">La implementación predeterminada de este servicio cuando se ejecuta en .NET 4 usa el registro del proveedor ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="8b424-274">The default implementation of this service when running on .NET 4 uses the ADO.NET provider registration.</span></span> <span data-ttu-id="8b424-275">Esto significa que si no está registrado el proveedor de ADO.NET de la manera normal porque se está resolviendo DbProviderFactory con EF, a continuación, también será necesario resolver este servicio.</span><span class="sxs-lookup"><span data-stu-id="8b424-275">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span>
